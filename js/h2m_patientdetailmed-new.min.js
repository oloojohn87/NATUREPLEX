function createLocationsList(){$("#add_locations").dialog({autoOpen:!0,resizable:!1,height:550,width:550,modal:!0})}function createPracticesList(){$("#add_practices").dialog({autoOpen:!0,resizable:!1,height:250,width:550,modal:!0})}function setLocation(e){var t="setLocation.php?id="+e;$.ajax({url:t,dataType:"json",async:!1,success:function(e){locations=e.items}}),$("#cname2").val(locations[0].cname),$("#pname2").val(locations[0].pname),$("#address12").val(locations[0].address1),$("#address22").val(locations[0].address2),$("#city2").val(locations[0].city),$("#state2").val(locations[0].state),$("#zip2").val(locations[0].zip),$("#phone2").val(locations[0].phone),$("#fax2").val(locations[0].fax),$("#id2").val(locations[0].id);var a=locations[0].cname,r=locations[0].address1,i=locations[0].address2,o=locations[0].city,n=locations[0].state,s=locations[0].zip,l=locations[0].phone,c=locations[0].fax,d=locations[0].id,p=$("#USERID").val(),u=$("#MEDID").val(),f=($("#NPI").val(),$("#DEA").val(),$("#practice").val()),h=$("#id3").val();if(""==a)alert("Your clinic has not been named and therefore we cannot provide access to our e-prescription platform.");else if(""==r)alert("Your clinic does not have a street address assigned and therefore we cannot provide access to our e-prescription platform.");else if(""==o)alert("Your clinic does not have a city assigned and therefore we cannot provide access to our e-prescription platform.");else if(""==n|n.length<2|n.length>2)alert("Your clinic does not have a state assigned and therefore we cannot provide access to our e-prescription platform.  Please use two character state format like TX.");else if(""==s|s.length<5|s.length>5)alert("Your clinic does not have a zip assigned and therefore we cannot provide access to our e-prescription platform.  Please use 5 digit format like 75287.");else if(""==l|l.length<10)alert("Your clinic does not have a phone number assigned and therefore we cannot provide access to our e-prescription platform.  Please include the area code like 555-555-5555.");else if(""==c|c.length<10)alert("Your clinic does not have a fax number assigned and therefore we cannot provide access to our e-prescription platform.  Please include the area code like 555-555-5555.");else if(""==d)alert("We cannot seem to find your account identifier.  Try logging into your account again to reset your account identifier.");else{var g=document.querySelector("#add_location");g.style.display="none";var b=document.querySelector("#location_table");b.style.display="none",$("#ePrescribe_Modal").html('<iframe src="mdtoolbox/index.php?modal=1&IdUsu='+p+"&medid="+u+"&cname="+a+"&address1="+r+"&address2="+i+"&city="+o+"&state="+n+"&zip="+s+"&phone="+l+"&fax="+c+"&id="+d+"&practice="+f+"&practiceid="+h+'" width="1000" height="660" scrolling="no" style="width:1000px;height:660px; margin: 0px; border: 0px solid #FFF; outline: 0px; padding: 0px; overflow: hidden;"></iframe>')}}function setPractice(e){var t="setLocation.php?id="+e+"&show=practice";$.ajax({url:t,dataType:"json",async:!1,success:function(e){locations=e.items}}),$("#practice").val(locations[0].practice),$("#id3").val(locations[0].id);{var a=locations[0].practice,r=locations[0].id;$("#USERID").val(),$("#MEDID").val(),$("#NPI").val(),$("#DEA").val()}if(""==a)alert("Your practice has not been named and therefore we cannot provide access to our e-prescription platform.");else if(""==r)alert("We cannot seem to find your account identifier.  Try logging into your account again to reset your account identifier.");else{var l=document.querySelector("#add_practice");l.style.display="none";var c=document.querySelector("#practice_table");c.style.display="none",pullLocationsList(r)}}function pullLocationsList(e){var t=$("#MEDID").val(),a="getLocationsList.php?docid="+t+"&id="+e;$.ajax({url:a,dataType:"html",complete:function(){},success:function(e){$("#ePrescribe_Modal").html(e)}})}function fileSelected(){var e=document.getElementById("fileToUpload2").files[0];if(e){var t=0;t=e.size>1048576?(Math.round(100*e.size/1048576)/100).toString()+"MB":(Math.round(100*e.size/1024)/100).toString()+"KB",document.getElementById("fileName").innerHTML="Name: "+e.name,document.getElementById("fileSize").innerHTML="Size: "+t,document.getElementById("fileType").innerHTML="Type: "+e.type}}function uploadFile2(){var e=new FormData;e.append("fileToUpload2",document.getElementById("fileToUpload2").files[0]);var t=new XMLHttpRequest;t.upload.addEventListener("progress",uploadProgress,!1),t.addEventListener("load",uploadComplete,!1),t.addEventListener("error",uploadFailed,!1),t.addEventListener("abort",uploadCanceled,!1),t.open("POST","/uploadifyPatient.php?pullfile="+get_idusu),t.send(e)}function uploadProgress(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);document.getElementById("progressNumber").innerHTML=t.toString()+"%"}else document.getElementById("progressNumber").innerHTML="unable to compute"}function uploadComplete(){location.reload()}function uploadFailed(){alert("There was an error attempting to upload the file.")}function uploadCanceled(){alert("The upload has been canceled by the user or the browser dropped the connection.")}function inform_about_session(){""!=both_id&&$.ajax({url:"/ongoing_sessions.php?userid="+both_id,success:function(){}}),clearTimeout(sessionTimer),sessionTimer=setTimeout(inform_about_session,active_session_timer)}function ShowTimeOutWarning(){alert("Session expired");window.location="timeout.php"}function PrintAll(){for(var e=0;e<pages.length;e++)oWindow[e].print(),oWindow[e].close()}function next_click(){curr_file=-1==curr_file?0:(curr_file+1)%list.length,document.getElementById("verified_count_label").innerHTML=parseInt(curr_file)+1+"/"+parseInt(list.length);var t,e=list[curr_file];if("lockedfile.png"==e)t="/images/"+e;else if("deletedfile.png"==e)t="/images/"+e;else{var a="/DecryptFile.php?rawimage="+e+"&queMed="+both_id,i=(LanzaAjax(a),-1);""!=both_id&&(i=both_id),t="/temp/"+i+"/Packages_Encrypted/"+e}var o='<iframe id="ImagenN1" style="border:1px solid #666CCC" title="PDF" src="'+t+'" alt="Loading" frameborder="1" scrolling="auto" height="850" width="600" ></iframe>';$("#AreaConten1").html(o)}function previous_click(){curr_file=0==curr_file?list.length-1:(curr_file-1)%list.length,document.getElementById("verified_count_label").innerHTML=parseInt(curr_file)+1+"/"+parseInt(list.length);var t,e=list[curr_file];if("lockedfile.png"==e)t="/images/"+e;else if("deletedfile.png"==e)t="/images/"+e;else{var a="/DecryptFile.php?rawimage="+e+"&queMed="+both_id,i=(LanzaAjax(a),-1);""!=both_id&&(i=both_id),t="/temp/"+i+"/Packages_Encrypted/"+e}var o='<iframe id="ImagenN1" style="border:1px solid #666CCC" title="PDF" src="'+t+'" alt="Loading" frameborder="1" scrolling="auto" height="850" width="600" ></iframe>';$("#AreaConten1").html(o)}function LanzaAjax(e){var t="SIN MODIFICACIÓN";return $.ajax({url:e,dataType:"html",async:!1,complete:function(){},success:function(e){"string"==typeof e&&(t=e)}}),t}function setAddress(e,t,a,r,i){address=e+", "+t+", "+a,geocoder=new google.maps.Geocoder;var o={center:new google.maps.LatLng(parseInt(r),parseInt(i)),zoom:5,disableDefaultUI:!0,mapTypeId:google.maps.MapTypeId.ROADMAP};map=new google.maps.Map(document.getElementById("googleMap"),o),geocoder.geocode({address:address},function(e,t){t==google.maps.GeocoderStatus.OK?map.setCenter({lat:parseInt(r),lng:parseInt(i)}):alert("Geocode was not successful for the following reason: "+t)})}function initialize_map(e){var t="",a="";$.get("http://ipinfo.io/"+e,function(e){console.log(e.loc),console.log(e.city),console.log(e.region),console.log(e.country),city=e.city,region=e.region,country=e.country;var r=e.loc.split(",");t=r[0],a=r[1],address=city+", "+region+", "+country,setAddress(city,region,country,t,a)},"jsonp")}var med_id=$("#MEDID").val(),mem_id=$("#USERID").val(),both_id=$("#BOTH_ID").val(),get_idusu=$("#GET_IDUSU").val(),telemed_on=$("#TELEMED_ON").val(),telemed_value=$("#TELEMED_VALUE").val(),start_time=$("#START_TIME").val(),num_multireferral=$("#NUM_MULTIREFERRAL").val(),idusfixed_holder=$("#IDUSFIXED").val(),idusfixed_name=$("#IDUSFIXED_NAME").val(),lifepin_canal=$("#CANAL").val(),referral_id=$("#REFERRAL_ID").val(),other_doc=$("#OTHERDOC").val(),custom_look=$("#CUSTOM_LOOK").val(),id_med_name=$("#IdMEDName").val(),id_med_surname=$("#IdMEDSurname").val(),med_user_name=$("#MEDUSERNAME").val(),med_user_surname=$("#MEDUSERSURNAME").val();$("input[type='image']").click(function(){$("input[id='fileToUpload2']").click()}),jQuery("input[id='fileToUpload2']").change(function(){$("input[id='make_upload']").click()});var list=new Array,curr_file=-1,timeoutTime=18e6,timeoutTimer=setTimeout(ShowTimeOutWarning,timeoutTime),active_session_timer=6e4,sessionTimer=setTimeout(inform_about_session,active_session_timer),offset1=0,last_pos=0,num_reports=0,jump=8,timeline_loaded=!1,oWindow=new Array,pages;$("#classification_datepicker").datepicker({inline:!0,nextText:"&rarr;",prevText:"&larr;",showOtherMonths:!0,dateFormat:"mm-dd-yy",dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],showOn:"button",buttonImage:"images/calendar-blue.png",buttonImageOnly:!0,changeYear:!0,changeMonth:!0,yearRange:"1900:c"}),$(document).ready(function(){function t(e){$.ajax({url:e,dataType:"script",async:!1})}function a(e,a){t("realtime-notifications/lib/gritter/js/jquery.gritter.min.js");var r={title:e,text:a,image:"images/Icono_H2M.png",sticky:!1,time:"3000"};$.gritter.add(r)}function y(e){var t=!1;return $.ajax({url:e,async:!1,success:function(){t=!0},error:function(){}}),t}function w(){var e=get_idusu;if(med_id>0)var t=med_id;else var t=get_idusu;var a=1;e==t&&(a=0);var r="TimelineNEW.php?usuario="+e+"&medid="+t+"&isdoctor="+a;$.ajax({url:r,dataType:"html",complete:function(){},beforeSend:function(){},success:function(){I("jsondata2.txt"),timeline_loaded=!0}})}function I(e){createStoryJS({width:"100%",debug:!1,height:"100%",source:e,type:"timeline",embed_id:"timeline-embed",start_at_end:!0})}function T(e){if(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(),200==t.status}return!1}function D(){var e=$("#MEDID").val(),t="getLocationsList.php?docid="+e+"&show=practice";$.ajax({url:t,dataType:"html",complete:function(){},success:function(e){$("#ePrescribe_Modal").html(e)}})}function C(e){$.ajax({url:e,dataType:"json",async:!1,success:function(e){pines=e.items}})}function A(e,t){var a=new RegExp(t,"gi");return e.match(a)?e.match(a).length:0}function F(e,t){if(last_pos<=$(e).scrollLeft()&&(console.log($(e).scrollLeft()+$(e).width()),console.log(160*offset1+60),$(e).scrollLeft()+$(e).width()>R)){{setTimeout(function(){},1e3)}last_pos=$(e).scrollLeft(),$(e).children().eq(0).children().last().css("display","block");{U(t,offset1)}}}function U(e,t){var r=e,i=$("#userId").val(),o=$("#MEDID").val();0>o&&(o=$("#USERID").val()),$("#stream_load_indicator").css("display","block");var n=1;i==o&&(n=0);var s="createReportStreamDocGroupNEWTEST.php?ElementDOM=na&EntryTypegroup="+r+"&Usuario="+i+"&MedID="+o+"&offset="+t+"&jump="+jump+"&isDoctor="+n,l='<span class="label label-success" style="left:0px; margin-left:0px; margin-top:20px; margin-bottom:20px; font-size:14px; text-shadow:none; text-decoration:none;background-color:red">Could not load Reports due to Internet issues</span>';$.ajax({url:s,dataType:"html",complete:function(){},success:function(e){if("string"==typeof e&&(l=e,offset1=t+jump),l!=L){var a=A(l,"note2"),r=$("#ascroll").width()+160*a;R=r,console.log("new_width: "+R),$("#ascroll").css("width",r+"px"),$("#ascroll").children().eq($("#ascroll").children().length-2).after(l),setTimeout(function(){Pt()},1e3),$("#stream_load_indicator").css("display","none"),L=l,8>a&&($("#ascroll").children().last().css("display","none"),$("#ascroll").css("width",$("#ascroll").width()-70))}},error:function(){a("Failed to Load Data","")}})}function K(e){if(e.classList.contains("recording"))window.clearInterval(audiotimer),W.stop(),e.classList.remove("recording"),$("#record").val("Start"),$("#saveaudio").prop("disabled",!1);else{if(!W)return void alert("Error in capturing audio");$("#saveaudio").prop("disabled",!0),e.classList.add("recording"),$("#record").val("Stop"),W.clear(),W.record();var a=(new Date,0);audiotimer=setInterval(function(){$(".Timer").text(a++ +" Seconds")},1e3)}}function Q(){W.exportWAV(st)}function at(){if(!V){var t=document.getElementById("analyser");X=t.width,J=t.height,V=t.getContext("2d")}var a=3,r=1,i=Math.round(X/a),o=new Uint8Array(analyserNode.frequencyBinCount);analyserNode.getByteFrequencyData(o),V.clearRect(0,0,X,J),V.fillStyle="#F6D565",V.lineCap="round";for(var n=analyserNode.frequencyBinCount/i,s=0;i>s;++s){for(var l=0,c=Math.floor(s*n),d=0;n>d;d++)l+=o[c+d];l/=n;{o[s*n]}V.fillStyle="hsl( "+Math.round(360*s/i)+", 100%, 50%)",V.fillRect(s*a,J,r,-l)}Y=window.requestAnimationFrame(at)}function it(e){G=q.createGain(),z=q.createMediaStreamSource(e),H=z,H.connect(G),analyserNode=q.createAnalyser(),analyserNode.fftSize=2048,G.connect(analyserNode),W=new Recorder(G),zeroGain=q.createGain(),zeroGain.gain.value=0,G.connect(zeroGain),zeroGain.connect(q.destination),at()}function nt(){navigator.getUserMedia||(navigator.getUserMedia=navigator.webkitGetUserMedia||navigator.mozGetUserMedia),navigator.cancelAnimationFrame||(navigator.cancelAnimationFrame=navigator.webkitCancelAnimationFrame||navigator.mozCancelAnimationFrame),navigator.requestAnimationFrame||(navigator.requestAnimationFrame=navigator.webkitRequestAnimationFrame||navigator.mozRequestAnimationFrame),ot=1,navigator.getUserMedia({audio:!0},it,function(e){alert("Error getting audio"),ot=0,console.log(e)})}function st(e){var t=new XMLHttpRequest;$("#wait_audio").show(),t.onload=function(e){4===this.readyState&&console.log("Server returned: ",e.target.responseText)},t.onreadystatechange=function(){4==t.readyState&&200==t.status&&(alert("Audio data successfully saved into Health2me Server."),$("#saveaudio").prop("disabled",!0),$("#wait_audio").hide(),$(".Timer").text(""),$("#closeaudiotab").click()),4==t.readyState&&200!=t.status&&(alert("Audio data transfer error!"),$("#saveaudio").prop("disabled",!0),$("#wait_audio").hide(),$(".Timer").text(""))};var a=new FormData;a.append("file",e);var r=0;""!=both_id&&(r=both_id),t.open("POST","upload_file_audio.php?queId="+get_idusu+"&from="+r,!0),t.send(a)}function dt(e){return document.getElementById(e)}function ut(e){e.stopPropagation(),e.preventDefault(),e.target.className="dragover"==e.type?"hover":""}function ft(e){ut(e);var t=e.target.files||e.dataTransfer.files;if(mt=t,0==ct)return void alert("Please select the type of the report");if(t.length>1)alert("This feature only allows to upload single file at once");else for(var r,a=0;r=t[a];a++){var i=dt("messages");i.innerHTML="Selected File: "+t[a].name}}function gt(e){if(!(location.host.indexOf("sitepointstatic")>=0)){var t=new XMLHttpRequest;if(t.upload){$("#H2M_Spin_upload").css("visibility","visible"),vt=1,t.onreadystatechange=function(){4==t.readyState&&(progress.className=200==t.status?"success":"failure",200==t.status&&($("#H2M_Spin_upload").css("visibility","hidden"),vt=0,setTimeout(function(){window.location.reload()},100)))};var a=new FormData;a.append("file",e),a.append("reportdate",lt),a.append("reporttype",ct),t.open("POST",dt("upload").action,!0),t.send(a)}}}function $t(){{var e=dt("fileselect");dt("filedrag"),dt("submitbutton")}e.addEventListener("change",ft,!1);var r=new XMLHttpRequest;r.upload}function St(){var t="0",a=$("#userId").val(),r=$("#MEDID").val(),i="createAttachmentStreamNEWTEST.php?ElementDOM=na&EntryTypegroup="+t+"&Usuario="+a+"&MedID="+r;$("#attachments").load(i),$("#attachments").trigger("update")}function Pt(){for(var e=0;h>e;e++)for(var t=$("#referralcolor"+e).val(),a=$("#reportid_review"+e).val(),r=a.split(" "),i=0,o=r.length;o>i;++i)0!=r[i].length&&$('i[id^="report-eye"]').each(function(){var e=parseInt($(this).parents("div.note2").attr("id"));e==parseInt(r[i])&&($(this).css("color","#000000"),$(this).parents("div.note2").css({border:"2px solid"}),$(this).parents("div.note2").css({"border-radius":"7px"}),$(this).parents("div.note2").css({outline:"none"}),$(this).parents("div.note2").css({"border-color":t}),$(this).parents("div.note2").css({"box-shadow":"0 0 10px "+t}))})}function a(e,t){var a={title:e,text:t,image:"images/Icono_H2M.png",sticky:!1,time:"6000"};$.gritter.add(a)}function Nt(e){var t="getUserData.php?UserId="+e;$.ajax({url:t,dataType:"json",async:!1,success:function(e){user=e.items}})}function Rt(e){var t="getMedCreator.php?UserId="+e;$.ajax({url:t,dataType:"json",async:!1,success:function(e){doctor=e.items}})}function At(e,t,a){var r="getReportCreator.php?Idpin="+e+"&Iddoc="+t+"&Idusu="+a;$.ajax({url:r,dataType:"json",async:!1,success:function(e){reportcreator=e.items}})}function Lt(e){var t="SIN MODIFICACIÓN";return $.ajax({url:e,dataType:"html",async:!1,complete:function(){},success:function(e){"string"==typeof e&&(t=e)}}),t}var r=new Pusher("d869a07d8f17a76448ed"),i=$("#BOTH_ID").val(),o=r.subscribe(i);if(o.bind("notification",function(e){a("New Message",e)}),$("body").bind("mousedown keydown",function(){clearTimeout(timeoutTimer),timeoutTimer=setTimeout(ShowTimeOutWarning,timeoutTime)}),telemed_on)var n=!0;else var n=!1;var s=telemed_value,l=$("#phoneTelemed").dialog({bigframe:!0,width:550,height:200,autoOpen:!1}),c=$("#videoTelemed").dialog({bigframe:!0,width:550,height:440,minWidth:550,minHeight:440,sticky:!1,modal:!1,autoOpen:!1,dialogClass:"telemedModalClass",position:{my:"left+70",of:"#NombreComp"},resize:function(){$("#remoteVideo").children("video").each(function(){$(this).css("height","100%"),$(this).css("width","100%")})},beforeClose:function(){$.post("update_webrtc.php",{doc_id:$("#MEDID").val(),status:0},function(){})}});n&&(console.log("true"),$.post("retrieveLatestConsultation.php",{doctor:$("#MEDID").val(),patient:$("#USERID").val()},function(e){var a=JSON.parse(e),r=a.description;console.log(e),null!=r&&r.length>0?($("#telemedicine_user_notes").text('"'+r+'"'),$("#telemedicine_user_notes").css("display","block"),$("#telemedicine_user_notes_label").css("display","block")):($("#telemedicine_user_notes").css("display","none"),$("#telemedicine_user_notes_label").css("display","none")),$("#telemedicine_start").css("display","block")})),$("#start_telemedicine").on("click",function(){if(n&&2==s){l.show(),l.dialog("open");var e=6e5,t=1e3*start_time;t>e?e=0:e-=t,console.log(e),setTimeout(function(){$(".timer").css("border","3px solid red"),$(".timer").css("color","red")},e),$("#startButton1").trigger("click")}else if(n&&1==s){var a="http://dev.health2.me:8888",r=new SimpleWebRTC({localVideoEl:"localVideo",remoteVideosEl:"remoteVideo",autoRequestMedia:!0,url:a});r.on("readyToCall",function(){$(window).on("unload",function(){$.post("update_webrtc.php",{doc_id:$("#MEDID").val(),status:0},function(){})}),setTimeout(function(){$(".timer").css("border","3px solid red"),$(".timer").css("color","red")},6e5),$("#startButton").trigger("click"),r.joinRoom("health2me_room_"+$("#MEDID").val()+"_"+$("#USERID").val()),!r.connection.DetectRTC.hasMicrophone&&r.connection.DetectRTC.hasWebcam&&alert("It appears that you do not have a microphone connected.  Please connect a microphone to your computer and try again.  If this problem persists, your microphone may be being used by another application.  Restart your computer to reset your hardware."),r.connection.DetectRTC.hasMicrophone&&!r.connection.DetectRTC.hasWebcam&&alert("It appears that you do not have a web camera connected.  Please connect a web camera to your computer and try again.  If this problem persists, your web camera may be being used by another application.  Restart your computer to reset your hardware."),r.connection.DetectRTC.hasMicrophone||r.connection.DetectRTC.hasWebcam||alert("It appears that you do not have a web camera or microphone connected.  Please connect a web camera and microphone to your computer and try again.  If this problem persists, your web camera and microphone may be being used by another application.  Restart your computer to reset your hardware."),$("#remoteVideo").css("height",(.6538461538*$("#videoTelemed").css("width")*.68).toString()+"px"),$("#remoteVideo").css("width",(.68*$("#videoTelemed").css("width")).toString()+"px"),$("#telemed_notes").attr("rows",Math.floor(.6538461538*$("#videoTelemed").css("width")*.68)/22);var e=setInterval(function(){$("#remoteVideo").children("video").each(function(){$(this).css("height","100%"),$(this).css("width","100%"),clearInterval(e)})},200);$.post("update_webrtc.php",{doc_id:$("#MEDID").val(),pat_id:$("#USERID").val(),status:1,add_to_recent_doctors:1},function(){}),setInterval(function(){$.post("update_webrtc.php",{doc_id:$("#MEDID").val(),update_lastseen:!0},function(e){console.log(e)})},3e4),$("#remoteVideo").children("video").each(function(){$(this).css("height","100%"),$(this).css("width","100%")}),$("a").click(function(){$.post("update_webrtc.php",{doc_id:$("#MEDID").val(),status:0},function(){})})}),c.dialog("open"),$(".telemedModalClass").children(".ui-dialog-titlebar").append('<span id="icon_float" class="icon-unlock" style="float: right; margin-right: 15px; margin-top: 3px; cursor: pointer;"></span>'),$("#icon_float").on("click",function(){$(this).hasClass("icon-unlock")?(c.dialog({sticky:!0}),$(this).removeClass("icon-unlock").addClass("icon-lock")):(c.dialog({sticky:!1}),$(this).removeClass("icon-lock").addClass("icon-unlock"))})}}),$("#tabsWithStyle").hide();for(var f=($("#userId").val(),$("#MEDID").val(),0),h=parseInt(num_multireferral),g=new Array,b=0;h>b;b++)f=1,g[b]=parseInt($("#referral_state"+b).val());var _;0==f&&(_=parseInt($("#referral_state").val()),isNaN(_)&&(_=0)),$(".PrintHighlighted").live("click",function(){var e=$(this).attr("id"),t="mergePDF.php?referralID="+e;$.ajax({url:t,dataType:"html",async:!0,success:function(t){RecTipo=t;var r="temp/"+$("#MEDID").val()+"/"+e+".pdf";if(1==y(r)){pages=[r];for(var i=0;i<pages.length;i++)oWindow[i]=window.open(pages[i]);setTimeout("PrintAll()",5e3),$("#H2M_Spin_Stream_Print").hide()}else a("Error","No highlighted reports to print"),$("#H2M_Spin_Stream_Print").hide()},error:function(){a("Error","Error Printing Reports"),$("#H2M_Spin_Stream_Print").hide()}})}),$("#AddEvolution").live("click",function(){$("#evolution_modal").dialog("close");var e=get_idusu,t=$("#evolution_date").val(),a=$("#evolution_text").val();if(""==t)return void alert("Enter Valid Date");if(""==a)return void alert("Enter some text");var r="add_evolutions.php?userid="+e+"&date="+t+"&text="+a,i=Lt(r);if("success"==i){var r="EvolutionPDF.php?idusu="+e,i=Lt(r);window.location.reload()}else alert("Error Adding Data")}),$("#CloseEvolution").live("click",function(e){e.preventDefault(),$("#evolution_modal").dialog("close")}),$("#AddNote").live("click",function(){var t=med_id,a='"'+$("#note_findings").val()+'"',r='"'+$("#note_recommendations").val()+'"';$.post("storePatientNotesTemp.php",{doctorId:t,findings:a,recommendations:r},function(e){console.log(e)})}),$(".nav-container").click(function(){$("#AreaConten").hide(),$("#AreaTipo").innerHtml="",$("#AreaClas").innerHTML=""}),$(".marker").live("click",function(e){if(void 0!==e.originalEvent){var t=$("#"+this.id).index(),a=0,r=1;$(".note2").each(function(){r==t&&(a=$(this).attr("id")),r++}),location.href="#"+a;var i=$(window).height(),o=$("#"+a).height(),n=$("#"+a).position(),s=n.top,l=i/2-o/30;window.scroll(0,s-l),$("#"+a).effect("pulsate"),$("#AreaConten").hide(),$("#AreaTipo").html(""),$("#AreaClas").html("")}}),$("#NewMES").live("click",function(){var e="/getInboxMessageUNREAD.php?IdMED="+med_id+"&patient="+mem_id+"&sendingdoc="+yt[b];$.ajax({url:e,dataType:"json",async:!1,success:function(e){NewMES=e.items}}),Pa=NewMES.length;var t=0;for(MesTimeline="";Pa>t;){var a=NewMES[t].MessageINIT.charCodeAt(0),r="RGB()";switch(!0){case 0==a:result="Equals Zero.";break;case a>=64&&78>=a:r="#0066CC";break;case a>=79&&100>=a:r="#00CC66";break;case a>=101:r="#663300"}var i=new Date(NewMES[t].MessageDATE),o=i.format("dddd mmmm dd, yyyy");MesTimeline+='<div style="float:left; width:100%; margin-top:15px; ">',MesTimeline+='<div style="float:left; width:10%; ">',2==t?MesTimeline+='<img src="/images/PersonalPicSample.jpeg" style="margin-left:0px; width: 40px; height: 40px; border:#cacaca;" class="img-circle">':MesTimeline=MesTimeline+'<div class="LetterCircleON" style="width:40px; height:40px; font-size:12px; margin-left:0px; background-color:'+r+';"><p style="margin:0px; padding:0px; margin-top:13px;">'+NewMES[t].MessageINIT+"</p></div>	",MesTimeline+="</div>",MesTimeline+='<div style="float:left; width:87%; margin-left:3%; border-bottom:thin dotted #cacaca;">',MesTimeline=MesTimeline+'<p style="font-weight:bold; font-size:14px; ">'+NewMES[t].MessageSEND+'<span style="color:#cacaca; float:right; font-size:12px; font-weight:normal;">    '+o+"</span> </p>",MesTimeline=MesTimeline+'<p style="color:grey; font-weight:bold; font-size:12px; margin-bottom:-5px; margin-top:-10px;">'+NewMES[t].MessageSUBJ+"</p>",MesTimeline=MesTimeline+'<p style="color:grey; margin-bottom:0px; ">'+NewMES[t].MessageCONT.replace(/sp0e/gi," ")+"</p>";var n=NewMES[t].MessageRIDS.split(" ");if(NumReports=n.length-1,NumReports>0){MesTimeline+='<div style="margin:0 auto; width:95%; border:solid #cacaca; border-radius:5px; height:80px;">';for(var s=0;NumReports>s;){var l="/DecryptFileId.php?reportid="+n[s]+"&queMed="+med_id,c=Lt(l),d=c.substr(0,c.indexOf("."))+".png";MesTimeline=MesTimeline+'<img class="ThumbTwitt" id="'+n[s]+'" style="height:70px; margin:5px; border:solid 1px #cacaca;" src="temp/'+med_id+"/PackagesTH_Encrypted/"+d+'">',s++}MesTimeline+="</div>"}MesTimeline+='<p style="color:#cacaca; font-size:10px; margin-left:50px;"> <span style="margin-right:15px;"><i style="font-size:10px; margin-right:5px;" class="icon-mail-reply"></i>Reply</span><span style="margin-right:15px;"><i style="font-size:10px; margin-right:5px;" class="icon-arrow-right"></i>Forward</span><span style="margin-right:15px;"><i style="font-size:10px; margin-right:5px;" class="icon-bookmark"></i>Mark</span></p>',MesTimeline+="</div>",MesTimeline+="</div>",t++}$("#NewMES").html(MesTimeline)}),$(".ThumbTwitt").live("click",function(){var e=$(this).attr("id"),t="/DecryptFileId.php?reportid="+e+"&queMed="+med_id,a=Lt(t),r=a,i="temp/"+med_id+"/Packages_Encrypted/"+r;$("#ZoomedIframe").attr("src",i),$("#ZoomedIframe").css("display","inline")}),$("body",$("#ZoomedIframe").contents()).click(function(){$("#ZoomedIframe").css("display","none")}),$("#TLineScrollDown").live("click",function(){var e=document.getElementById("TLineScrollDown");e.style.display="none";var e=document.getElementById("TLineScrollUp");return e.style.display="block",1==timeline_loaded?void $("#timeline-box").slideDown("slow"):(w(),void $("#timeline-box").slideDown("slow"))}),$("#TLineScrollUp").live("click",function(){var e=document.getElementById("TLineScrollDown");e.style.display="block";var e=document.getElementById("TLineScrollUp");e.style.display="none",$("#timeline-box").slideUp("slow")}),$("#Clases").live("change",function(){var e=$(this).val(),t=String(e).substr(0,1),a=String(e).substr(1,2);$("#SelecERU").val(t),$("#SelecEvento").val(a)}),$("#Tipos").live("change",function(){var e=$(this).val();$("#SelecTipo").val(e)}),$("#BotonMod").hide(),$(".CFILAMODAL").live("click",function(){var r=$("td",this).eq(3).text();console.log("IP Address : "+r),google.maps.event.addDomListener(window,"load",initialize_map(r)),$("#header-modalMap").html('<div id="googleMap" style="width:500px;height:380px;"></div><div style="text-align:center; margin-top:10px; width:100%"><button id="close-map" type="button" >Close</button></div>'),$("#BotonModalMap").trigger("click"),$("#BotonModalMap").show()}),$("#close-map").live("click",function(){$("#header-modalMap").hide()}),$("#CloseModal22").live("click",function(){$("#BotonModalMap").hide()}),$("#BotonModalMap").live("click",function(){e.preventDefault(),$("#BotonModalMap").show()}),$("#PrintImage").live("click",function(){var e=$("#ImagenN").attr("src"),t="";return null==e?void alert("Select a Report"):(t+=e.substr(e.lastIndexOf("/")+1,e.length),myWindow.focus(),void window.print())}),$(".icon-trash").live("click",function(){var e=this.parentNode.parentNode.parentNode.getAttribute("id"),t="/getReportStatus.php?IdPin="+e,r=Lt(t);if(2==r)return void alert("This report contains Patients Basic EMR Data. It cannot be deleted !");if(1==r)return void alert("This report has already been deleted !");if(3==r){var i=confirm("Are You sure you want to delete this report.");if(!i)return;{var t="/deleteReports.php?IdPin="+e+"&state="+r,n=(Lt(t),"report marked deleted"),s=0,l=$("#MEDID").val(),c=0,t="/LogEvent.php?IDPIN="+e+"&Content="+n+"&VIEWIdUser="+s+"&VIEWIdMed="+l+"&MEDIO="+c;Lt(t)}a("status","Report Deleted"),window.location.reload()}}),$("#EvolutionToggle").live("click",function(){var e="Packages_Encrypted/"+get_idusu+".pdf",t=T(e);if(t){var a=get_idusu+".pdf",r="/DecryptFile.php?rawimage="+a+"&queMed="+med_id,o=(Lt(r),"/temp/"+med_id+"/Packages_Encrypted/"+a),n='<iframe id="ImagenN1" style="border:1px solid #666CCC" title="PDF" src="'+o+'" alt="File Not Found" frameborder="1" scrolling="auto" height="850" width="600" ></iframe>';$("#AreaConten2").html(n),$("#modal_evolution_display").trigger("click")}else{var s="Evolution/DataNotFound.jpg",n='<iframe id="ImagenN1" style="border:1px solid #666CCC" title="PDF" src="'+s+'" alt="File Not Found" frameborder="1" scrolling="auto" height="850" width="600" ></iframe>';$("#AreaConten2").html(n),$("#modal_evolution_display").trigger("click")}});$("#evolution_modal").dialog({width:531,height:284,autoOpen:!1,resizable:!1,modal:!0});$("#EvolutionButton").on("click",function(){var e=new Date,t=e.getDate(),a=e.getMonth()+1,r=e.getFullYear();10>a&&(a="0"+a),10>t&&(t="0"+t);var i=r+"-"+a+"-"+t;$("#evolution_date").attr("value",i),$("#evolution_modal").dialog("open")}),$("#PhoneNotes").on("click",function(){$("#modal_phoneNotes").trigger("click")});var x=$("#summary_modal").dialog({bigframe:!0,width:1050,height:690,resize:!1,modal:!0,autoOpen:!1});$("#Summary_Button").on("click",function(e){e.preventDefault();var t=$("#USERID").val();$("#summary_modal").html('<iframe src="medicalPassport.php?modal=1&IdUsu='+t+'" width="1000" height="660" scrolling="no" style="width:1000px;height:660px; margin: 0px; border: 0px solid #FFF; outline: 0px; padding: 0px; overflow: hidden;"></iframe>'),x.dialog("open")});var k=$("#ePrescribe_Modal").dialog({bigframe:!0,width:1050,height:690,resize:!1,modal:!0,autoOpen:!1});$("#ePrescribe").on("click",function(e){e.preventDefault();{var r=($("#USERID").val(),$("#MEDID").val(),$("#NPI").val());$("#DEA").val()}""==r|0==r?$("#add_credentials").dialog({autoOpen:!0,resizable:!1,height:250,width:520,modal:!0}):(D(),k.dialog("open"))}),$("#create_location").on("click",function(){var e=$("#cname").val(),t=$("#address1").val(),a=$("#address2").val(),r=$("#city_holder").val(),i=$("#state_holder").val(),o=$("#zip_holder").val(),n=$("#phone_holder").val(),s=$("#fax_holder").val(),l=$("#MEDID").val(),c=$("#id3").val();if(""==e)alert("You must enter the full name of your clinic you will be prescribing from.");else if(""==t)alert("You must enter the address of the clinic you will be prescribing from.");else if(""==r)alert("You must enter the city of the clinic you will be prescribing from.");else if(""==i|i.length<2)alert("You must enter the state of the clinic you will be prescribing from.");else if(""==o|o.length<5)alert("You must enter the state of the clinic you will be prescribing from.");else if(""==n|n.length<10)alert("You must enter the phone number of the clinic you will be prescribing from.");else if(""==s|s.length<10)alert("You must enter the fax number of the clinic you will be prescribing from.");else{{var d="createLocationsData.php?cname="+e+"&pid="+c+"&address1="+t+"&address2="+a+"&city="+r+"&state="+i+"&zip="+o+"&phone="+n+"&fax="+s+"&docid="+l;
Lt(d)}alert("Location has been added for e-prescribing."),$("#add_locations").dialog("close"),e=$("#cname").val(""),t=$("#address1").val(""),a=$("#address2").val(""),r=$("#city_holder").val(""),i=$("#state_holder").val(""),o=$("#zip_holder").val(""),n=$("#phone_holder").val(""),s=$("#fax_holder").val(""),pullLocationsList(c)}}),$("#create_practice").on("click",function(){var e=$("#practice2").val(),t=$("#MEDID").val();if(""==e)alert("You must enter the name of your practice you will be prescribing from.");else{{var a="createLocationsData.php?practice="+e+"&docid="+t;Lt(a)}alert("Practice has been added for e-prescribing."),$("#add_practices").dialog("close"),e=$("#practice2").val(""),D()}}),$("#create_credentials").on("click",function(){var e=$("#npi_number").val(),t=$("#dea_number").val(),a=$("#MEDID").val();if(""==e|e.length<10)alert("You must enter a valid NPI number to e-prescribe.");else if(""==t)alert("You must enter a valid DEA number to e-prescribe.");else{{var r="createCredentials.php?docid="+a+"&npi="+e+"&dea="+t;Lt(r)}alert("Your credentials have been added.  Please fax a copy of your drivers license to XXX-XXX-XXXX to complete the verification process."),$("#add_credentials").dialog("close"),$("#NPI").val(e),$("#DEA").val(t)}}),$(".Telemed_Summary_Button").on("click",function(){var t=$("#USERID").val();$("#summary_modal").html('<iframe src="medicalPassport.php?modal=1&IdUsu='+t+'" width="1000" height="660" scrolling="no" style="width:1000px;height:660px; margin: 0px; border: 0px solid #FFF; outline: 0px; padding: 0px; overflow: hidden;"></iframe>'),x.dialog("open")}),$(".Telemed_Notes_Button").on("click",function(){$("#modal_phoneNotes").trigger("click")});var E=0,S=$("#please_wait_modal").dialog({bgiframe:!0,width:300,height:200,modal:!0,autoOpen:!1});$(".Telemed_Close_Button").on("click",function(){S.dialog("open"),$.post("update_webrtc.php",{doc_id:$("#MEDID").val(),status:0},function(){});var t=-1;""!=both_id&&(t=both_id);var r,i,o,a=get_idusu;l.dialog("close"),c.dialog("close"),$.get("getNotes.php?doctorId="+t,function(e){console.log(e),r=JSON.parse(e),i=r.findings,o=r.recommendations,console.log("In Get Notesfindings is:"+i+"reco is:"+o),$.post("addPatientNotes.php",{doctorId:t,userId:a,findings:i,recommendations:o},function(){$.post("SavePatientSummaryAsPDF_table.php",{IdUsu:a},function(e){console.log("Result Data for Summary: "+e),$.post("charge_for_consultation.php",{user:a,doctor:t},function(e){E=e,2!=s?$.post("video_appointment_callback.php",{doc_id:t,pat_id:a},function(){$.get("sendPatientNotesAndSummary.php?doctorId="+t+"&userId="+a+"&cost="+E,function(){S.dialog("close"),window.location="patientdetailMED-new.php?IdUsu="+a})}):$.get("sendPatientNotesAndSummary.php?doctorId="+t+"&userId="+a+"&cost="+E,function(){S.dialog("close"),window.location="patientdetailMED-new.php?IdUsu="+a})})})})})}),$("#History").live("click",function(){var e=$("#ImagenN").attr("src"),t="";if(null==e)return void alert("Select a Report");"/images/deletedfileTH.png"==e?t=$("#ImagenN").attr("alt"):t+=e.substr(e.lastIndexOf("/")+1,e.length),console.log("Raw Image "+t);var r="/getReportData.php?rawimage="+t;C(r),IDEt='<span class="label label-info" style="font-size:18px; padding:5px 10px 5px 10px; font-family: “Andale Mono”, AndaleMono, monospace;">ID:'+pines[0].idpin+" </span>";var i="";i='<span class="label label-success" style="font-size:18px; padding:5px 10px 5px 10px; font-family: “Andale Mono”, AndaleMono, monospace; margin-left:20px;">Uploaded By : '+pines[0].idmedfixedname+"</span>",$("#InfoIDPaciente").html(IDEt+i);var o="/getReportHistory.php?id="+pines[0].idpin,n="/getReportViewers.php?id="+pines[0].idpin;console.log("URL 1 : "+o),console.log("URL 2 : "+n),$("#TablaPacMODALViewers").load(n,function(){$("#view-history-load").hide()}),$("#TablaPacMODALViewers").trigger("update"),$("#TablaPacMODAL").load(o),$("#TablaPacMODAL").trigger("update"),$("#BotonModal1").trigger("click")}),$("#BotonAddClase").live("click",function(){var e=prompt("Please enter new Episode (class)","");if(null!=e&&""!=e){{var t=$("#queUsu").val(),a=$("#queBlock").val(),r=$("#UltimoEvento").val(),i="/AnadeClase.php?queBlock="+a+"&queUser="+t+"&UltimoEvento="+r+"&Nombre="+e;Lt(i)}$("#Episodios").append("<option value="+(r+1)+' selected="selected">'+e+"</option>"),$("#UltimoEvento").val(1+parseInt(r))}}),$("#BotonElimClase").live("click",function(){var e=$("#Episodios").find(":selected").text(),t=confirm("Confirm removal of episode ("+e+") ?");if(1==t){{var a=$("#queUsu").val(),r=$("#queBlock").val(),i=$("#UltimoEvento").val(),o="/EliminaClase.php?queBlock="+r+"&queUser="+a+"&UltimoEvento="+i+"&Nombre="+e;Lt(o)}$("#Episodios option:selected").remove(),$("#CloseModal").trigger("click")}}),$("#GrabaDatos").live("click",function(){var t=($("#Episodios").find(":selected").text(),confirm("Confirm updating information for this block ?"));if(1==t){var a=$("#queUsu").val(),r=$("#queBlock").val(),o=($("#UltimoEvento").val(),$("#SelecERU").val()),n=$("#SelecEvento").val(),s=$("#SelecTipo").val(),l="";""!=idusfixed_holder&&(l=idusfixed_holder);var c="";""!=idusfixed_name&&(c=idusfixed_name);var d=-1;""!=both_id&&(d=both_id);{var p=$("#classification_datepicker").val(),u="/GrabaClasif.php?queBlock="+r+"&queUser="+a+"&queERU="+o+"&queEvento="+n+"&queTipo="+s+"&idusfixed="+l+"&idusfixedname="+c+"&Idmed="+d+"&fecha="+p;Lt(u)}$("#Episodios option:selected").remove(),$("#CloseModal").trigger("click"),window.location.reload()}}),$("#BotonRecords").live("click",function(){var e=$("#userId").val(),t=-1;""!=both_id&&(t=both_id);var a="get_file_list.php?ElementDOM=na&EntryTypegroup=0&Usuario="+e+"&MedID="+t,r=Lt(a);list=r.split(";"),curr_file=-1,list.pop(),next_click()}),jQuery.fn.outerHTML=function(e){return e?this.before(e).remove():jQuery("&lt;p&gt;").append(this.eq(0).clone()).html()},$("#choose_report_button").on("click",function(){$("#fileselect").trigger("click")}),$("#BotonUpload").live("click",function(){});var P="",N=1,R=0;$(".TABES").live("click",function(){if($("#ascroll").length){var e=document.getElementById("ascroll");e.parentNode.removeChild(e)}$(this).addClass("active");var t=$(this).attr("id"),a="";switch($("#stream_indicator").css("display","block"),$("#StreamContainerALL").hide(),$("#StreamContainerIMAG").hide(),$("#StreamContainerLABO").hide(),$("#StreamContainerDRRE").hide(),$("#StreamContainerOTHE").hide(),$("#StreamContainerNA").hide(),$("#StreamContainerSUMM").hide(),$("#StreamContainerPICT").hide(),$("#StreamContainerPATN").hide(),$("#StreamContainerSUPE").hide(),$("#StreamContainerPICT").hide(),t){case"0":a="#StreamContainerALL";break;case"1":a="#StreamContainerIMAG";break;case"2":a="#StreamContainerLABO";break;case"3":a="#StreamContainerDRRE";break;case"4":a="#StreamContainerOTHE";break;case"5":a="#StreamContainerNA";break;case"6":a="#StreamContainerSUMM";break;case"7":a="#StreamContainerPICT";break;case"8":a="#StreamContainerPATN";break;case"9":a="#StreamContainerSUPE";break;case"10":a="#StreamContainerLCKR";break;default:a="testDIV"}P=a;var r=t,i=$("#userId").val(),o=$("#MEDID").val();0>o&&(o=$("#USERID").val()),10!=r&&(s="getNumThumbnails.php?ElementDOM=na&EntryTypegroup="+r+"&Usuario="+i+"&MedID="+o),num_reports=Lt(s),N=1;var n=1;i==o&&(n=0);var s="";s=10==r?"createReportStreamLocked.php?ElementDOM=na&EntryTypegroup="+r+"&Usuario="+i+"&MedID="+o+"&isDoctor="+n:"createReportStreamNEWTEST.php?ElementDOM=na&EntryTypegroup="+r+"&Usuario="+i+"&MedID="+o+"&num_reports="+num_reports+"&isDoctor="+n;var l='<span class="label label-success" style="left:0px; margin-left:0px; margin-top:20px; margin-bottom:20px; font-size:14px; text-shadow:none; text-decoration:none;background-color:red">Could not load Reports due to Internet issues</span>';setTimeout(function(){$.ajax({url:s,dataType:"html",async:!1,complete:function(){},success:function(e){"string"==typeof e&&(l=e,$(a).html(l),$(a).scrollLeft(0),offset1=10,R=160*offset1+60,last_pos=0,$("#stream_indicator").css("display","none"))},error:function(){$(a).html(l)}}),$(a).trigger("click")},1e3),setTimeout(function(){Pt()},1e3),$(a).show()}),$("#sliderleft").live("click",function(){var e=$(P).scrollLeft()-600;$(P).animate({scrollLeft:e},800)}),$("#sliderright").live("click",function(){var e=$(P).scrollLeft()+600;$(P).animate({scrollLeft:e},800)}),$("#sliderleft").hide(),$("#sliderright").hide(),$("#hscroll").hover(function(){$("#sliderleft").fadeIn("fast"),$("#sliderright").fadeIn("fast")},function(){$("#sliderleft").fadeOut("fast"),$("#sliderright").fadeOut("fast")}),$("#StreamContainerALL").scroll(function(){F("#StreamContainerALL",0)}),$("#StreamContainerIMAG").scroll(function(){F("#StreamContainerIMAG",1)}),$("#StreamContainerLABO").scroll(function(){F("#StreamContainerLABO",2)}),$("#StreamContainerDRRE").scroll(function(){F("#StreamContainerDRRE",3)}),$("#StreamContainerOTHE").scroll(function(){F("#StreamContainerOTHE",4)}),$("#StreamContainerNA").scroll(function(){F("#StreamContainerNA",5)}),$("#StreamContainerSUMM").scroll(function(){F("#StreamContainerSUMM",6)}),$("#StreamContainerPICT").scroll(function(){F("#StreamContainerPICT",7)}),$("#StreamContainerPATN").scroll(function(){F("#StreamContainerPATN",8)}),$("#StreamContainerSUPE").scroll(function(){F("#StreamContainerSUPE",9)});var L="";$("#BotonTestRS").live("click",function(){var e="testDIV",t="3",a=$("#userId").val(),r=$("#MEDID").val();0>r&&(r=$("#USERID").val());var i=1;a==r&&(i=0);var o="CreateReportStream.php?ElementDOM="+e+"&EntryTypegroup="+t+"&Usuario="+a+"&MedID="+r+"&isDoctor="+i;$("#StreamContainer").load(o),$("#StreamContainer").trigger("update")});var O=400,j=0,B=null;$(".note2").live("click",function(e,t){var i=get_idusu,o=!1;both_id>=0&&(i=both_id,o=!0);var n=$(this).index(),s=-1;if($(".marker").each(function(){s==n&&(id=$(this).attr("id")),s++}),$("#AreaConten").show(),j++,console.log("clicks: "+j),void 0!==e.originalEvent)if(1===j){var l;window.location.href="#AreaConten",l=void 0!=t?document.getElementById(t):this,console.log(l);var c=$(".queBLD",l).attr("id");console.log("queBLD"+c),B=setTimeout(function(){var e=$(".queBLD",l).attr("id"),t=$(l).attr("id"),r=$(".quePEN",l).attr("id"),o=$(".queDEL",l).attr("id");if(null==e)if(null==r){var n=$(".queTIP",l).attr("id"),s=$(".queEVE",l).attr("id"),c=$(".queFEC",l).attr("id"),d=$("#IdUsuP").val();if(null==o){var p=$(".queIMG",l).children("img").attr("alt");1==p?$("#BotonMod").show():$("#BotonMod").hide();var u=i,m=t,v="Report Viewed",f=mem_id,h=u,g=0,b="/LogEvent.php?IDPIN="+m+"&Content="+v+"&VIEWIdUser="+f+"&VIEWIdMed="+h+"&MEDIO="+g,w=(Lt(b),$(".queIMG",l).attr("id")),I=w.substr(w.length-3,3),T=w.substr(0,w.length-4),M=w.substr(3,2),x=0;if(-1==w.indexOf(".")&&(x=1),x)return $("#BotonMod").hide(),$("#AreaConten").show(),window.open("http://54.225.67.15/AlmaWebPlatform/WebViewer/webviewer.php?AccessionNumber="+m+"&PatientID="+d+"&Width=1680&Height=911&Orientation=undefined&workerMode=2","IsPacs","width=1680,height=911"),0;if("pdf"==I||"png"==I)var b="/DecryptFile.php?rawimage="+w+"&queMed="+i,k=(Lt(b),"/temp/"+i+"/PackagesTH_Encrypted/"+T+".png"),D="/temp/"+i+"/Packages_Encrypted/"+T+"."+I,E='<iframe id="ImagenN" style="border:1px solid #666CCC; margin:0 auto; display:block;" title="PDF" src="'+D+'" alt="'+t+'" frameborder="1" scrolling="auto" height="850" width="600" ></iframe>',S='<img id="ImagenTH"  src="'+k+'" alt="">';else if("MOV"==I){{var b="/DecryptFile.php?rawimage="+w+"&queMed="+i;Lt(b)}$("#AreaConten").hide(),alert("Videos may take time to load depending on your internet speed .");var C="/temp/"+i+"/Packages_Encrypted/"+T+"."+I;$("#media-active").html('<embed src="'+C+'" height="500" width="800" controller="true" autoplay="true" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/" >'),$("#media-active").show()}else if("jpg"==I||"jpeg"==I||"JPG"==I)var b="/DecryptFile.php?rawimage="+w+"&queMed="+i,k=(Lt(b),"/temp/"+i+"/PackagesTH_Encrypted/"+w),D="/temp/"+i+"/Packages_Encrypted/"+w,E='<img id="ImagenN" style="border:1px solid #666CCC; margin:0 auto; display:block;max-height:1500px;max-width:600px;"  src="'+D+'" alt="'+t+'">',S='<img  id="ImagenTH"  src="'+k+'" alt="" style="max-height:1500px;max-width:600px;">';else{var P=null;if(""!=lifepin_canal&&(P=lifepin_canal),"7"==P||"png"==I||"PNG"==I)var b="/DecryptFile.php?rawimage="+w+"&queMed="+i,k=(Lt(b),"/temp/"+i+"/PackagesTH_Encrypted/"+w),E='<img id="ImagenN" src="/temp/'+i+"/Packages_Encrypted/"+w+'" alt="'+t+'" style="border:1px solid #666CCC; margin:0 auto; display:block;">';else if("XX"==M)var b="/DecryptFile.php?rawimage="+w+"&queMed="+i,k=(Lt(b),"/temp/"+i+"/PackagesTH_Encrypted/"+w),E='<img id="ImagenN" src="/temp/'+i+"/Packages_Encrypted/"+w+'" alt="'+t+'" style="border:1px solid #666CCC; margin:0 auto; display:block;">';else var k="/eMapLife/PinImageSetTH/"+w,E='<img id="ImagenN" src="/eMapLife/PinImageSet/'+w+'" alt="'+t+'" style="border:1px solid #666CCC; margin:0 auto; display:block;">';var S='<img id="ImagenTH"  src="'+k+'" alt="'+t+'">'}}else var N=$(".queDEL",l).attr("id"),D="/images/deletedfileTH.png",E='<iframe id="ImagenN" style="border:1px solid #666CCC; margin:0 auto; display:block;" title="PDF" src="'+D+'" alt="'+N+'" frameborder="1" scrolling="auto" height="850" width="600" ></iframe>',S='<img id="ImagenTH"  src="/images/deletedfile.png" alt="">';$("#AreaConten").html(E),$("#RepoThumb").html(S),$("#AreaTipo").html(n),$("#AreaClas").html(s),$("#AreaFecha").html('<span class="label label-warning" style="font-size:16px;">'+c+"</span>");var R="getTipoClase.php?BlockId="+t;if(console.log("getTipoClase : "+t),$(".ContenDinamico").load(R),$(".ContenDinamico").trigger("update"),2==_){var b="getReportInformationReview.php?referralid="+referral_id,A=Lt(b);if(parseInt(A)){$("div#infr").css("color","#3d93e0"),$("div#infr").children("*").css("color","#3d93e0"),$(l).css("color","#3d93e0");var b="setReferralStage.php?referralid="+referral_id+"&stage=3";Lt(b),_=3,$("div#infr_btn").append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>');{var b='push_server.php?message="Referral stage information review is completed"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+i+"&channel="+other_doc,F=(Lt(b),"referal stage information review is completed. This is a system Generated Message"),L="Referral stage information",U=0,b="sendMessage.php?sender="+i+"&receiver="+other_doc+"&patient="+mem_id+"&content="+F+"&subject="+L+"&attachments="+U+"&connection_id="+referral_id;Lt(b)}a("status","Referal stage information review is completed"),setTimeout(function(){window.location.reload(!0)},2e3)}}}else alert("An unlock request for the report(s) has already been send to screen user.Pending user confirmation!!");else{var O=$(l).attr("id");$("#Idpin").attr("value",O);var B=$("#userId").val();Nt(B),$("#TextoSend").html(""),$("#ConfirmaLink,#ConfirmaLinkAll").show(),$("#Thisreport,#Allreport").show(),""==user[0].email?($("#BotonModal").trigger("click"),$("#ConfirmaLink").hide(),$("#Thisreport").hide()):$("#BotonModal").trigger("click")}j=0},O)}else{l=void 0!=t?document.getElementById(t):this,clearTimeout(B);var p=($("#IdUsuP").val(),$(l).attr("id")),c=$(".queBLD",l).attr("id"),u=$(".quePEN",l).attr("id"),m=$(".queIMG",l).children("img").attr("alt");if(null==c&&null==u)if(1==m){$("#BotonMod").show();var v="/getprivacystatus.php?Idpin="+p+"&state=0+&type=0",f=Lt(v),h="",g="";if("normal"==f){if(h=confirm("Please confirm that you want to make this report private!"),1==h)var v="/getprivacystatus.php?Idpin="+p+"&state=1+&type=1",f=Lt(v)}else if("private"==f){if(g=confirm("Please confirm that you want to remove the privacy of this report!"),1==g)var v="/getprivacystatus.php?Idpin="+p+"&state=1+&type=0",f=Lt(v)}else"superprivate"==f&&alert("Privacy of this report cannot be changed!");{$(l).attr("id")}}else $("#BotonMod").hide(),alert("You don't have permissions to change the privacy of this file!");j=0}}).live("dblclick",function(e){e.preventDefault()}),$("#SendButton").live("click",function(){var e=$(this).attr("value"),t=$("#Idpin").val();"00A"==t&&(t=-111);var a;a="Request Patient"==e?1:2;var r;"checked"==$("#c2").attr("checked")&&(r=1);var i=$("#userId").val();Nt(i);var o=$("#IdMEDName").val(),n=$("#IdMEDSurname").val(),s=$("#MEDID").val(),l=$("#IdMEDEmail").val();-111==t?(console.log("-111"),At(t,s,i)):At(t,0,0);var c;if(0==reportcreator.length){var d;if(2==a)return void alert("Reportcreator not found!");if(d=confirm("Reportcreator not found. Do you want to continue!!"),!d)return;reportcreator=user,c=user}for(var p=0,u=reportcreator.length;u>p;++p)if(c==user||(c=reportcreator[p]),""==user[0].email){var m=user[0].IdCreator;if(Rt(m),c==user)return void alert("Both reportcreator and Patient details are not found in the system. Please contact support!!");{var v="Unlock report from Dr. "+o+" "+n,f="Dr. "+o+" "+n+" has requested to see reportID"+t+"of your patient named: "+user[0].Name+" "+user[0].Surname+" (UserId:  "+i+"). Please confirm, or just close this message to reject.";"Dr. "+c.Name+" "+c.Surname}if(1==r){var g=c.phone;null!=g?(g=g.replace(/[^0-9]/g,""),10==g.length||11==g.length||(g="Null")):alert("Health2me could not find a valid phone number!");var b="/MsgInterno.php?Tipo=1&IdPac="+user[0].Identif+"&To="+c.id+"&ToEmail="+c.IdMEDEmail+"&NameDoctor="+c.Name+"&SurnameDoctor="+c.Surname+"&NameDoctorOrigin="+o+"&SurnameDoctorOrigin="+n+"&NamePatient="+user[0].Name+"&SurnamePatient="+user[0].surname+"&callphone="+g+"&From="+s+"&FromEmail="+l+"&Subject="+v+"&Content="+f+"&Leido=0&Push=0&estado=1&Idpin="+t}else var b="/MsgInterno.php?Tipo=1&IdPac="+user[0].Identif+"&To="+c.id+"&ToEmail="+c.IdMEDEmail+"&NameDoctor="+c.Name+"&SurnameDoctor="+c.Surname+"&NameDoctorOrigin="+o+"&SurnameDoctorOrigin="+n+"&NamePatient="+user[0].Name+"&SurnamePatient="+user[0].surname+"&From="+s+"&FromEmail="+l+"&Subject="+v+"&Content="+f+"&Leido=0&Push=0&estado=1&Idpin="+t;var _=Lt(b)}else{var e,o=$("#IdMEDName").val(),n=$("#IdMEDSurname").val(),s=$("#MEDID").val(),l=$("#IdMEDEmail").val(),v="Unlock report";if(c==user&&(a=1),1==a){var f="Dr. "+o+" "+n+" has requested to see your (UserId:  "+i+") reportID"+t+" Please confirm, or just close this message to reject.";if(1==r){var g=user[0].telefono;null!=g?(g=g.replace(/[^0-9]/g,""),10==g.length||11==g.length||(alert("Phone number is not valid!"),g="Null")):alert("Health2me could not find a valid phone number!");var b="/MsgInterno.php?Tipo=0&IdPac=0&To="+i+"&ToEmail="+user[0].email+"&NameDoctor="+user[0].Name+"&SurnameDoctor="+user[0].Surname+"&NameDoctorOrigin="+o+"&SurnameDoctorOrigin="+n+"&NamePatient="+user[0].Name+"&SurnamePatient="+user[0].Surname+"&callphone="+g+"&From="+s+"&FromEmail="+l+"&Subject="+v+"&Content="+f+"&Leido=0&Push=0&estado=1&Idpin="+t}else var b="/MsgInterno.php?Tipo=0&IdPac=0&To="+i+"&ToEmail="+user[0].email+"&NameDoctor="+user[0].Name+"&SurnameDoctor="+user[0].Surname+"&NameDoctorOrigin="+o+"&SurnameDoctorOrigin="+n+"&NamePatient="+user[0].Name+"&SurnamePatient="+user[0].Surname+"&From="+s+"&FromEmail="+l+"&Subject="+v+"&Content="+f+"&Leido=0&Push=0&estado=1&Idpin="+t;if(1==p)break}else{if(2!=a)return void alert("Incorrect option!");if(-111!=Idpin){var y=confirm("You have selected doctor to send request.This request would be send to unlock all applicable reports and not limited to only this report!");if(!y)return}var f="Dr. "+o+" "+n+" has requested to see your (UserId:  "+i+") reportID"+t+" Please confirm, or just close this message to reject.";if(1==r){var g=c.phone;null!=g?(g=g.replace(/[^0-9]/g,""),10==g.length||11==g.length||(alert("Phone number is not valid!"),g="Null")):alert("Health2me could not find a valid phone number!");var b="MsgInterno.php?Tipo=1&IdPac="+user[0].Identif+"&To="+c.id+"&ToEmail="+c.IdMEDEmail+"&NameDoctor="+c.Name+"&SurnameDoctor="+c.Surname+"&NameDoctorOrigin="+o+"&SurnameDoctorOrigin="+n+"&NamePatient="+user[0].Name+"&SurnamePatient="+user[0].Surname+"&callphone="+g+"&From="+s+"&FromEmail="+l+"&Subject="+v+"&Content="+f+"&Leido=0&Push=0&estado=1&Idpin="+t}else var b="MsgInterno.php?Tipo=1&IdPac="+user[0].Identif+"&To="+c.id+"&ToEmail="+c.IdMEDEmail+"&NameDoctor="+c.Name+"&SurnameDoctor="+c.Surname+"&NameDoctorOrigin="+o+"&SurnameDoctorOrigin="+n+"&NamePatient="+user[0].Name+"&SurnamePatient="+user[0].Surname+"&From="+s+"&FromEmail="+l+"&Subject="+v+"&Content="+f+"&Leido=0&Push=0&estado=1&Idpin="+t}console.log(b);var _="Temporal";$.get(b,function(e){"string"==typeof e&&(_=e)})}$(".modal").modal("hide")}),$("#ConfirmaLink,#ConfirmaLinkAll").live("click",function(){var t=$(this).attr("value");"All reports"==t&&$("#Idpin").attr("value","00A");var a=$("#userId").val();if(Nt(a),""==user[0].email){var r="<span>Patient email not found. Request will be sent to reportcreator!</span><br><br>";r+='<p><input type="button" class="btn btn-success" value="Request Doctor" id="SendButton" style="margin-left:10px; margin-top:-15px;"></p>',r+='<input type="checkbox" id="c2" name="cc"><label for="c2" style="margin-top:10px;"><span></span></label><i class="icon-phone"></i><span></span>Urgent(call phone) ',$("#TextoSend").html(r)}else{var r='<span>Please select "request Patient" or "request doctor".</span><span>The unlock request would be send accordingly.<span><br><br>';r+='<p><input type="button" class="btn btn-success" value="Request Patient" id="SendButton" style="margin-left:20px; margin-top:-15px;">',r+='<input type="button" class="btn btn-success" value="Request Doctor" id="SendButton" style="margin-left:25px; margin-top:-15px;"></p>',r+='<input type="checkbox" id="c2" name="cc"><label for="c2" style="margin-top:30px;margin-left:10px;"><span></span></label><i class="icon-phone"></i><span></span>Urgent(call phone)',$("#TextoSend").html(r)}$("#ConfirmaLink,#ConfirmaLinkAll").hide(),$("#Thisreport,#Allreport").hide()}),$("#saveaudio").prop("disabled",!0);var X,J,q=new AudioContext,H=null,z=null,G=null,W=null,Y=null,V=null,ot=0;$("#Dictate").live("click",function(){0==ot&&nt(),$("#message_modal_audio").click()}),$("#record").live("click",function(){K(this)}),$("#saveaudio").live("click",function(){Q()}),$("#APP_Date").datepicker({inline:!0,nextText:"&rarr;",prevText:"&larr;",showOtherMonths:!0,dateFormat:"yy-mm-dd",dayNamesMin:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],showOn:"button",buttonImage:"images/calendar-blue.png",buttonImageOnly:!0,changeYear:!0,changeMonth:!0,yearRange:"1900:c"});var lt;$("#datepicker2").change(function(){lt=$("#datepicker2").val()});var ct=1;$("#report_type").val(1),$("#reptype").change(function(){var e=document.getElementById("reptype");ct=e.options[e.selectedIndex].value,$("#report_type").val(ct),console.log("Report are of Type is "+$("#report_type").html)});var mt,vt=0;window.File&&window.FileList&&window.FileReader&&$t(),$("#BotonUpload_New").live("click",function(){if("COL"==custom_look&&$.post("get_num_reports.php",{id:$("#USERID").val()},function(e){parseInt(e)}),(5>Et&&"COL"==custom_look)|"COL"!=custom_look){var e="",t="";if("th"==language){e="Cargar Informe";var t="Cancelar"}else if("en"==language){e="Upload Report";var t="Cancel"}$("#upload_reports_form").dialog({autoOpen:!0,resizable:!1,height:460,width:700,modal:!0,buttons:[{text:e,click:function(){if(0==vt)if(null==lt||0==ct)alert("Report Date or Type Missing. Enter these values before proceeding");else if(mt.length>1)alert("This feature only allows to upload single file at once");else for(var t,e=0;t=mt[e];e++)gt(t);else alert("Health2Me detected that you are pressing the Upload button Multiple times! Doesn't matter it will upload file only once")},style:"background-color: #5EB529; color: #FFF; outline: 0px; border: 0px solid #FFF; border-radius: 5px; width: 150px; font-size: 14px;"},{text:t,click:function(){0!=vt&&alert("Your report is being sent to Health2Me central repository. Please wait!"),$(this).dialog("close")},style:"background-color: #D84840; color: #FFF; outline: 0px; border: 0px solid #FFF; border-radius: 5px; width: 150px; font-size: 14px;"}],close:function(){0!=vt&&alert("Your report is being sent to Health2Me central repository. Please wait!")}})}else alert("You have reached your limit of 5 uploads. To upload more records, you need to delete some records")});var bt=new Array,_t=new Array,yt=new Array;if(1==f)for(var b=0;h>b;b++)bt[b]=parseInt($("#referral_id"+b).val()),yt[b]=parseInt($("#otherdocid"+b).val()),_t[b]=parseInt($("#referraltype"+b).val()),g[b]>=1?($("div#ack"+b).css("color","#3d93e0"),$("div#ack"+b).children("*").css("color","#3d93e0"),$("div#ack_btn"+b+" a").css("color","#3d93e0"),$("#ack_ok"+b).show(),$("div#ack_btn"+b).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right" id="ack_arrow'+b+'"></i>'),g[b]>=2&&(1==_t[b]?($("div#infr_ref"+b).css("color","#3d93e0"),$("div#infr_ref"+b).children("*").css("color","#3d93e0"),$("div#infr_ref_btn"+b+" a").css("color","#3d93e0"),$("div#infr_ref_btn"+b).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>'),3==g[b]&&($("div#cmnt_ref"+b).css("color","#3d93e0"),$("div#cmnt_ref"+b).children("*").css("color","#3d93e0"),$("div#cmnt_ref_btn"+b+" a").css("color","#3d93e0"))):($("div#app"+b).css("color","#3d93e0"),$("div#app"+b).children("*").css("color","#3d93e0"),$("div#app_btn"+b+" a").css("color","#3d93e0"),$("div#app_btn"+b).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>'),g[b]>=3&&($("div#infr"+b).css("color","#3d93e0"),$("div#infr"+b).children("*").css("color","#3d93e0"),$("div#infr_btn"+b+" a").css("color","#3d93e0"),$("div#infr_btn"+b).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>'),4==g[b]&&($("div#inpa"+b).css("color","#3d93e0"),$("div#inpa"+b).children("*").css("color","#3d93e0"),$("div#inpa_btn"+b+" a").css("color","#3d93e0")))))):-1==g[b]&&($("div#ack"+b).css("color","#F16C6C"),$("div#ack"+b).children("*").css("color","#F16C6C"),$("div#ack_btn"+b+" a").css("color","#F16C6C"),$("#ack_ok"+b).show(),$("div#ack_btn"+b+" a").attr("disabled","disabled"),$("div#app"+b).css("color","#F16C6C"),$("div#app"+b).children("*").css("color","#F16C6C"),$("div#app_btn"+b+" a").css("color","#F16C6C"),$("div#app_btn"+b+" a").attr("disabled","disabled"),$("div#infr"+b).css("color","#F16C6C"),$("div#infr"+b).children("*").css("color","#F16C6C"),$("div#infr_btn"+b+" a").css("color","#F16C6C"),$("div#infr_btn"+b+" a").attr("disabled","disabled"),$("div#inpa"+b).css("color","#F16C6C"),$("div#inpa"+b).children("*").css("color","#F16C6C"),$("div#inpa_btn"+b+" a").css("color","#F16C6C"),$("div#inpa_btn"+b+" a").attr("disabled","disabled")),setTimeout(function(){$("#newinbox"+b).trigger("click")},1e3);else _>=1&&($("div#ack").css("color","#3d93e0"),$("div#ack").children("*").css("color","#3d93e0"),$("div#ack_btn a").css("color","#3d93e0"),$("#ack_ok").show(),$("div#ack_btn").append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>'),_>=2&&($("div#app").css("color","#3d93e0"),$("div#app").children("*").css("color","#3d93e0"),$("div#app_btn a").css("color","#3d93e0"),$("div#app_btn").append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>'),_>=3&&($("div#infr").css("color","#3d93e0"),$("div#infr").children("*").css("color","#3d93e0"),$("div#infr_btn a").css("color","#3d93e0"),$("div#infr_btn").append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>'),4==_&&($("div#inpa").css("color","#3d93e0"),$("div#inpa").children("*").css("color","#3d93e0"),$("div#inpa_btn a").css("color","#3d93e0")))));$("div[id^='reject_btn'] a").live("click",function(){var e=$(this).parents("div[id^='reject_btn']").attr("id"),t=e.substring(e.length,e.length-1);option1=confirm("Are you sure you want to reject this referred patient ?"),option1&&($("#H2M_Spin").show(),setTimeout(function(){$("div#ack"+t).css("color","#F16C6C"),$("div#ack"+t).children("*").css("color","#F16C6C"),$("div#ack_btn"+t+" a").css("color","#F16C6C"),$("#ack_ok"+t).show(),$("#ack_arrow"+t).hide(),$("div#ack_btn"+t+" a").attr("disabled","disabled"),$("div#app"+t).css("color","#F16C6C"),$("div#app"+t).children("*").css("color","#F16C6C"),$("div#app_btn"+t+" a").css("color","#F16C6C"),$("div#app_btn"+t+" a").attr("disabled","disabled"),$("div#infr"+t).css("color","#F16C6C"),$("div#infr"+t).children("*").css("color","#F16C6C"),$("div#infr_btn"+t+" a").css("color","#F16C6C"),$("div#infr_btn"+t+" a").attr("disabled","disabled"),$("div#inpa"+t).css("color","#F16C6C"),$("div#inpa"+t).children("*").css("color","#F16C6C"),$("div#inpa_btn"+t+" a").css("color","#F16C6C"),$("div#inpa_btn"+t+" a").attr("disabled","disabled");var e="setReferralStage.php?referralid="+bt[t]+"&stage=-1";salida=Lt(e),g[t]=-1;{var e='push_server.php?message="Referral has been rejected!"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],i=(Lt(e)," The referral has been rejected. This is a System Generated Message"),o="Referral stage information",n=0,e="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+i+"&subject="+o+"&attachments="+n+"&connection_id="+bt[t];Lt(e)}$("#H2M_Spin").hide(),a("status","Referral rejection confirmed!"),("div#reject_btn"+t).hide()},1e3))}),$("div[id^='ack_btn_pending'] a").live("click",function(){var e=$(this).parents("div[id^='ack_btn_pending']").attr("id"),t=e.substring(e.length,e.length-1);$(this).parents("div.note2").attr("id");{var r="setReferralStage.php?referralid="+bt[t]+"&stage=1&pending=1";Lt(r)}g[t]=1,a("status","You have acknowledged the referred patient!");{var r='push_server.php?message="Referral stage Acknowledgement is complete!"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],o=(Lt(r),"referal stage Acknowledgement is completed. This is a System Generated Message"),n="Referral stage information",s=0,r="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+o+"&subject="+n+"&attachments="+s+"&connection_id="+bt[t];Lt(r)}setTimeout(function(){window.location.reload()},100)}),$("div[id^='ack_btn'] a").live("click",function(){var e=$(this).parents("div[id^='ack_btn']").attr("id"),t=e.substring(e.length,e.length-1);$(this).parents("div.note2").attr("id"),0==g[t]?alert("The referral stages functionality is not working. Please contact Health2me!"):g[t]>1&&a("status","This stage is already complete!")}),$("div[id^='inpa_btn'] a").live("click",function(){var e=$(this).parents("div[id^='inpa_btn']").attr("id"),t=e.substring(e.length,e.length-1);if(0==g[t])alert("The referral stages functionality is not working. Please contact Health2me!");else if(4==g[t]&&a("status","This stage is already complete!"),g[t]<3&&-1!=g[t])alert("Previous Stages are not complete!");else if(3==g[t]){$("div#inpa"+t).css("color","#3d93e0"),$("div#inpa"+t).children("*").css("color","#3d93e0"),$(this).css("color","#3d93e0");var r="setReferralStage.php?referralid="+bt[t]+"&stage=4";Lt(r),g[t]=4,a("status","Referral stages for this patient completed!");{var r='push_server.php?message="Referral stages has been completed"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],o=(Lt(r),"referal stage visit is completed. This is a System Generated Message"),n="Referral stage information",s=0,r="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+o+"&subject="+n+"&attachments="+s+"&connection_id="+bt[t];Lt(r)}}}),$("div[id^='infr_ref_btn'] a").live("click",function(){var e=$(this).parents("div[id^='infr_ref_btn']").attr("id"),t=e.substring(e.length,e.length-1);if(0==g[t])alert("The referral stages functionality is not working. Please contact Health2me!");else if(g[t]>=2)a("status","This stage is already complete!");else if(g[t]<1&&-1!=g[t])alert("Previous Stages are not complete!");else if(1==g[t]){var r="getReportInformationReview.php?referralid="+bt[t],i=Lt(r),o="false";if(o="true"==i?"true":confirm("All the report information has not been reveiwed for this patient. Do you still want to confirm review stage?")){$("div#infr_ref"+t).css("color","#3d93e0"),$("div#infr_ref"+t).children("*").css("color","#3d93e0"),$(this).css("color","#3d93e0");
var r="setReferralStage.php?referralid="+bt[t]+"&stage=2";Lt(r),g[t]=2,$("div#infr_ref_btn"+t).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>');{var r='push_server.php?message="Referral stage information review is completed"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],s=(Lt(r),"Referal stage information review is completed. This is a System Generated Message"),l="Referral stage information",c=0,r="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+s+"&subject="+l+"&attachments="+c+"&connection_id="+bt[t];Lt(r)}a("status","Referal stage information review is completed")}}});var wt=0;$("div[id^='cmnt_ref_btn'] a").live("click",function(){var e=$(this).parents("div[id^='cmnt_ref_btn']").attr("id"),t=e.substring(e.length,e.length-1);if(0==g[t])alert("The referral stages functionality is not working. Please contact Health2me!");else if(3==g[t]&&a("status","This stage is already complete!"),g[t]<2&&-1!=g[t])alert("Previous Stages are not complete!");else if(2==g[t])if(0==wt)alert("Stage cannot be marked complete as there has not been any communication. Please send atleast one message to complete this stage!");else{$("div#cmnt_ref"+t).css("color","#3d93e0"),$("div#cmnt_ref"+t).children("*").css("color","#3d93e0"),$(this).css("color","#3d93e0");var r="setReferralStage.php?referralid="+bt[t]+"&stage=3";Lt(r),g[t]=3,a("status","Referral stages for this patient completed!");{var r='push_server.php?message="Referral stages has been completed"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],o=(Lt(r),"Referal stage Comment is completed. This is a System Generated Message"),n="Referral stage information",s=0,r="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+o+"&subject="+n+"&attachments="+s+"&connection_id="+bt[t];Lt(r)}}}),$("div[id^='app_btn'] a").live("click",function(){var e=$(this).parents("div[id^='app_btn']").attr("id"),t=e.substring(e.length,e.length-1);if(0==g[t])alert("The referral stages functionality is not working. Please contact Health2me!");else if(g[t]>=2)a("status","This stage is already complete!");else if(1==g[t]){var r=confirm("Health2me couldn't find any appointments for this patient. Do you confirm that patient meeting has happened?");if(r){$("div#app"+t).css("color","#3d93e0"),$("div#app"+t).children("*").css("color","#3d93e0"),$(this).css("color","#3d93e0");var i="setReferralStage.php?referralid="+bt[t]+"&stage=2";Lt(i),g[t]=2,$("div#app_btn"+t).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>');{var i='push_server.php?message="Referral stage appointment is completed"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],n=(Lt(i),"referal stage appointment is completed. This is a System Generated Message"),s="Referral stage information",l=0,i="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+n+"&subject="+s+"&attachments="+l+"&connection_id="+bt[t];Lt(i)}}}}),$("div[id^='infr_btn'] a").live("click",function(){var e=$(this).parents("div[id^='infr_btn']").attr("id"),t=e.substring(e.length,e.length-1);if(0==g[t])alert("The referral stages functionality is not working. Please contact Health2me!");else if(g[t]>=3)a("status","This stage is already complete!");else if(g[t]<2&&-1!=g[t])alert("Previous Stages are not complete!");else if(2==g[t]){var r="getReportInformationReview.php?referralid="+bt[t],i=Lt(r),o="false";if(o="true"==i?"true":confirm("All the report information has not been reveiwed for this patient. Do you still want to confirm review stage?")){$("div#infr"+t).css("color","#3d93e0"),$("div#infr"+t).children("*").css("color","#3d93e0"),$(this).css("color","#3d93e0");var r="setReferralStage.php?referralid="+bt[t]+"&stage=3";Lt(r),g[t]=3,$("div#infr_btn"+t).append('<i style="margin-left:10px;font-size:15px" class="icon-arrow-right"></i>');{var r='push_server.php?message="Referral stage information review is completed"&NotifType=2&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[t],s=(Lt(r),"Referal stage information review is completed. This is a System Generated Message"),l="Referral stage information",c=0,r="sendMessage.php?sender="+both_id+"&receiver="+yt[t]+"&patient="+mem_id+"&content="+s+"&subject="+l+"&attachments="+c+"&connection_id="+bt[t];Lt(r)}a("status","Referal stage information review is completed")}}}),$("[id^='newinbox']").live("click",function(){var e=$(this).attr("id"),t=e.substring(e.length,e.length-1);It=t;var a="/getInboxMessage.php?IdMED="+both_id+"&patient="+both_id+"&sendingdoc="+yt[t],r=Lt(a);$("#datatable_3_"+t).html(r),$("#datatable_3_"+t).trigger("update")}),$("[id^='newoutbox']").live("click",function(){var e=$(this).attr("id"),t=e.substring(e.length,e.length-1);It=t;var a="/getOutboxMessage.php?IdMED="+both_id+"&patient="+mem_id+"&receivingdoc="+yt[t];$("#datatable_4_"+t).load(a),$("#datatable_4_"+t).trigger("update")}),setTimeout(function(){$("[id^='newinbox']").trigger("click")},1e3);var It=0;$("[id^='referraldoctab']").live("click",function(){var e=$(this).attr("id"),t=e.substring(e.length,e.length-1);It=t}),$("[id^='compose_message']").live("click",function(){var e=$(this).attr("id"),t=e.substring(e.length,e.length-1);It=t,$("#messagecontent_inbox").attr("value",""),$("#subjectname_inbox").attr("value",""),$("#subjectname_inbox").removeAttr("readonly"),$("#messagedetails").hide(),$("#replymessage").show(),$("#attachments").empty(),$("#attachments").hide(),$("#Reply").hide(),$("#CloseMessage").hide(),$("#Attach").hide(),$("#sendmessages_inbox").show(),$("#attachreports").show(),$("#message_modal").trigger("click")});var Tt="",Mt=new Array;$(".CFILA").live("click",function(){var e=$(this).attr("id");$('input[type=checkbox][id^="reportcol"]').each(function(){$('input[type=checkbox][id^="reportcol"]').checked=!1}),Mt.length=0;var t=$(this).find("span#"+e).text().replace(/br8k/g,"\n").replace(/sp0e/g," ");$(this).find("span").hide();var a=$(this).find("ul#"+e).text();if($("#attachments").empty(),a){var i="0",o=$("#userId").val(),n=$("#MEDID").val(),s="createAttachmentStreamNEWTEST.php?ElementDOM=na&EntryTypegroup="+i+"&Usuario="+o+"&MedID="+n+"&Reports="+a,l=Lt(s);$("#attachments").append(l),$("#attachments").show()}else $("#attachments").hide();$("#Attach").hide(),$("#messagedetails").show(),$("#replymessage").hide(),$("#Reply").attr("value","Reply"),$("#Reply").show(),$("#CloseMessage").show(),$("#messagedetails").val(t),$("#messagedetails").attr("readonly","readonly"),$("#messagedetails,#subjectname_inbox").css("cursor","pointer"),$("#subjectname_inbox").val($(this).find("a").text()),$("#subjectname_inbox").attr("readonly","readonly"),$("#replymessage").hide(),$("#sendmessages_inbox").hide(),$("#attachreports").hide(),$("#message_modal").trigger("click");var c="setMessageStatus.php?msgid="+e,l=Lt(c);setTimeout(function(){$("#newinbox"+It).trigger("click")},1e3)}),$(".CFILA_out").live("click",function(){var e=$(this).attr("id");$('input[type=checkbox][id^="reportcol"]').each(function(){$('input[type=checkbox][id^="reportcol"]').checked=!1}),Mt.length=0;var t=$(this).find("span#"+e).text().replace(/br8k/g,"\n").replace(/sp0e/g," ");$(this).find("span").hide();var a=$(this).find("ul#"+e).text();if($("#attachments").empty(),a){var i="0",o=$("#userId").val(),n=$("#MEDID").val(),s="createAttachmentStreamNEWTEST.php?ElementDOM=na&EntryTypegroup="+i+"&Usuario="+o+"&MedID="+n+"&Reports="+a,l=Lt(s);$("#attachments").append(l),$("#attachments").show()}else $("#attachments").hide();$("#Attach").hide(),$("#messagedetails").show(),$("#replymessage").hide(),$("#Reply").attr("value","Reply"),$("#Reply").hide(),$("#CloseMessage").show(),$("#messagedetails").val(t),$("#messagedetails").attr("readonly","readonly"),$("#messagedetails,#subjectname_inbox").css("cursor","pointer"),$("#subjectname_inbox").val($(this).find("a").text()),$("#subjectname_inbox").attr("readonly","readonly"),$("#replymessage").hide(),$("#sendmessages_inbox").hide(),$("#attachreports").hide(),$("#message_modal").trigger("click")}),$("#Reply").live("click",function(){var e="RE:"+$("#subjectname_inbox").val().replace(/RE:/,"");$("#subjectname_inbox").val(e),$("#messagedetails").hide(),$("#replymessage").show(),$("#attachments").hide(),$("#Attach").hide(),$(this).hide(),$("#CloseMessage").hide(),$("#sendmessages_inbox").show(),$("#attachreports").show()}),$("#Attach").live("click",function(){Tt="",$('input[type=checkbox][id^="reportcol"]').each(function(){var e=this.checked?"1":"0";if(1==e){var t=$(this).parents("div.attachments").attr("id");Mt.push(this.id),Tt=Tt+t+" "}});var e=!1;if(Tt>""&&(e=confirm("Confirm Attachments")),e)$("#Reply").trigger("click"),$("#attachreportdiv").append('<i id="attachment_icon" class="icon-paper-clip" style="margin-left:10px"></i>');else{for(Tt="",b=0;b<Mt.length;b++)document.getElementById(Mt[b]).checked=!1;Mt.length=0,$("#Reply").trigger("click")}});$("#attachreports").live("click",function(){$('input[type=checkbox][id^="reportcol"]').each(function(){var e=this.checked?"1":"0";1==e&&Mt.push(this.id)}),$("#attachments").empty(),St(),setTimeout(function(){for(b=0;b<Mt.length;b++)document.getElementById(Mt[b]).checked=!0},400),$("#attachment_icon").remove(),$("#sendmessages_inbox").hide(),$("#replymessage").hide(),$(this).hide(),$("#attachments").show(),$("#Attach").show(),$("#Reply").attr("value","Back"),$("#Reply").show()}),$("#sendmessages").live("click",function(){var t=($("#doctorsdetails").find(":selected").attr("id"),$("#messagecontent").val().replace(/ /g,"sp0e").replace(/\r\n|\r|\n/g,"br8k")),r=$("#subjectname").val();if(""==r||""==t)a("Error","Error sending message.Empty subject or content area!");else{var i="sendMessage.php?sender="+both_id+"&receiver="+yt[It]+"&patient="+mem_id+"&content="+t+"&subject="+r,o=Lt(i);$("#messagecontent").attr("value",""),$("#subjectname").attr("value",""),a("status",o);var i='push_server.php?message="message from a doctor"&NotifType=1&IdUsu='+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[It],o=Lt(i)}}),$("#sendmessages_inbox").live("click",function(){var t=($("#doctorsdetails").find(":selected").attr("id"),$("#messagecontent_inbox").val().replace(/ /g,"sp0e").replace(/\r\n|\r|\n/g,"br8k")),r=$("#subjectname_inbox").val();Tt=Tt.replace(/\s+$/g," "),1==_t[It]&&2==g[It]&&(wt=1);var i="sendMessage.php?sender="+both_id+"&receiver="+yt[It]+"&patient="+mem_id+"&content="+t+"&subject="+r+"&attachments="+Tt+"&connection_id="+referral_id,o=Lt(i);$("#messagecontent_inbox").attr("value",""),$("#subjectname_inbox").attr("value",""),a("status",o);var i="push_server.php?FromDoctorName="+id_med_name+"&FromDoctorSurname="+id_med_surname+"&Patientname="+med_user_name+"&PatientSurname="+$MedUserSurname+"&IdUsu="+mem_id+"&message= New Message <br>From: Dr. "+id_med_name+" "+id_med_surname+"<br>Subject: "+r.replace(/RE:/,"")+"&NotifType=1&IdUsu="+get_idusu+"&FromDoctorId="+both_id+"&channel="+yt[It],o=Lt(i);Tt="",$("#attachment_icon").remove(),$("#message_modal").trigger("click")}),$("[id^='delete_message']").live("click",function(){var e=$(this).attr("id"),t=e.substring(e.length,e.length-1);setWhichDoctorClicked=t;var r=0,i=confirm("The message will be deleted permanently!Press Ok to continue.");i&&($('input[type=checkbox][id^="checkcol"]').each(function(){var e=this.checked?"1":"0";if(1==e){var t=$(this).parents("tr.CFILA_P").attr("id");r+=1;var a="setMessageStatus.php?msgid="+t+"&delete=1";Lt(a)}}),r?(setTimeout(function(){$("#newinbox"+setWhichDoctorClicked).trigger("click")},50),a("status","Seleted Messages Deleted!")):a("status","No Messages Selected!"))}),$("div[id^='notif_']").live("click",function(){{var t=$(this).attr("id"),a=/\d+/.exec(t),r="/setNotificationStatus.php?Id="+a;Lt(r)}return $(this).remove(),e.stopPropagation(),!1}),$("div[id^='notif_']").live("mouseenter",function(){$(this).css("background","LightSteelBlue"),$(this).css("cursor","pointer")}),$("div[id^='notif_']").live("mouseleave",function(){$(this).css("background","")});var kt="/getNotificationCount.php?IdMED="+both_id,Dt=Lt(kt);parseInt(Dt)&&$("#notificaton_num").text(Dt);var Et=parseInt($("#notificaton_num").text());Et||($("#notificaton_num").hide(),$("#notification_triangle").hide()),setTimeout(function(){$("#newinbox").trigger("click")},1e3),$(document).click(function(){$("#notification_window").find("*").hide()}),$("a#notification_bar").live("click",function(e){$("a#notification_bar").toggle(function(){var e=parseInt($("#notificaton_num").text());e&&($("#notificaton_num").text(0),$("#notificaton_num").hide(),$("#notification_triangle").hide());var t="/getNotificationMessages.php?IdMED="+both_id;setTimeout(function(){$("#getnotificationmessages").load(t),$("#getnotificationmessages").trigger("update")},1),$("#notification_window").find("*").show()},function(){$("#notification_window").find("*").hide()}),e.stopPropagation()})}),$(window).load(function(){function a(){var t=e.find(".ui-progressbar-value"),r=e.progressbar("value")||0;e.progressbar("value",r+10),e.css({background:"black"}),t.css({background:"#4169E1"}),99>r&&setTimeout(a,50)}var e=$("#progressbar"),t=$(".progress-label");e.progressbar({value:!1,change:function(){t.css({color:"white"}),t.css({"text-shadow":"none"}),t.text(e.progressbar("value")+"%")},complete:function(){t.css({color:"white"}),t.css({"font-size":"10px"}),t.css({"text-shadow":"none"}),t.css({"text-align":"center"}),t.css({"margin-left":"-50px"}),t.text("Decryption Complete!"),setTimeout(function(){$("#progressstatus").hide(),$("#progressbar").hide(),$("#encryptbox").hide(),$("#tabsWithStyle").show();parseInt(num_multireferral)},500)}}),setTimeout(a,500)});