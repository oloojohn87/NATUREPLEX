function inform_about_session(){$.ajax({url:"ongoing_sessions.php?userid="+med_id,success:function(){}}),clearTimeout(sessionTimer),sessionTimer=setTimeout(inform_about_session,active_session_timer)}function ShowTimeOutWarning(){alert("Session expired");window.location="timeout.php"}function getInitialRadarData(){for(group=0,$("#Group_toggle").is(":checked")&&(group=1),getReferredPatients("getReferredPatients.php?group=0"),$thisreco=0;$thisreco<ReferredPatients.length;)PatientName[$thisreco]=ReferredPatients[$thisreco].PatientName,PatientStage[$thisreco]=ReferredPatients[$thisreco].PatientStage,PatientDoctor[$thisreco]=ReferredPatients[$thisreco].PatientDoctor,PatientDoctorFULL[$thisreco]=ReferredPatients[$thisreco].PatientDoctorFULL,DoctorId[$thisreco]=ReferredPatients[$thisreco].IdMED2,DoctorEmail[$thisreco]=ReferredPatients[$thisreco].EmailDoctor,PatientDoctor[$thisreco]<"   "&&(PatientDoctor[$thisreco]=DoctorEmail[$thisreco]),PatientTTV[$thisreco]=ReferredPatients[$thisreco].TTV,DoctorsNames[DoctorId[$thisreco]]=PatientDoctor[$thisreco],DoctorsNamesFULL[DoctorId[$thisreco]]=PatientDoctorFULL[$thisreco],DoctorsEmails[DoctorId[$thisreco]]=DoctorEmail[$thisreco],$thisreco++}function getReferredPatients(e){$.ajax({url:e,dataType:"json",async:!1,success:function(e){ReferredPatients="",ReferredPatients=e.items}})}function loadRadarData(){NPatients=$thisreco-1,NReferrals=ReferralNumber,MaxPatDisplay=20,NPatients>MaxPatDisplay?(Pages=Math.ceil(NPatients/MaxPatDisplay),PatientsPage=Math.ceil(NPatients/Pages)):(Pages=1,PatientsPage=NPatients,$("#MorePage").css("visibility","hidden"),$("#LessPage").css("visibility","hidden"),$("#pageNumber").css("visibility","hidden")),ActualPage=1,RadarPage()}function RadarPage(){layer.removeChildren(),layerDr.removeChildren(),layerEvents.removeChildren(),layerArcs.removeChildren(),layer.draw(),layerDr.draw(),layerEvents.draw(),layerArcs.draw(),PatIni=(ActualPage-1)*PatientsPage,PatEnd=ActualPage*PatientsPage,DrawRadarPatients(PatIni,PatEnd),$("#pageNumber").html("Page "+ActualPage+"/"+Pages)}function DrawStats(){$("#NReferrals").html(ReferralNumber),$("#NPatients").html($thisreco-1),$("#NTime2Visit").html(Math.round(MeanTTV/ReferralNumber)+" days")}function DrawRadarPatients(e,r){var t=200,a=175,o=0,s=parseInt(r);s>=PatientName.length&&(s=parseInt(PatientName.length)-1);var i=s-e+1;unidad=0!=i?2*Math.PI/i:Math.PI;var n=$("#myCanvas"),c=n.get(0).getContext("2d");c.lineWidth=1,c.beginPath(),c.moveTo(200,175);for(var l=e;parseInt(l)<=s;){switch(drawingOrder=l-e,stage=PatientStage[l]){case"":o=25;break;case"1":o=25;break;case"2":o=50;break;case"3":o=75;break;case"4":o=100}var d=-(.5*Math.PI)+drawingOrder*unidad,h=new Kinetic.Wedge({x:t,y:a,radius:o,angle:unidad,fillRadialGradientStartPoint:0,fillRadialGradientStartRadius:0,fillRadialGradientEndPoint:0,fillRadialGradientEndRadius:o,fillRadialGradientColorStops:[0,"#cacaca",1,"grey"],stroke:"#808080",strokeWidth:1,rotation:d,opacity:.9});layer.add(h),h.on("touchstart click mouseover",function(r){r.targetNode;this.setOpacity(.8),this.setStroke("black"),this.setStrokeWidth(2),layer.draw(),m=this.index,RealIndex=parseInt(m)+parseInt(e),$("#DrName").html(RealIndex+" "+PatientName[RealIndex]),$("#DrEmail").html(DoctorsNames[DoctorId[RealIndex]]),this.setOpacity(.4),this.setStroke(DrColor[RealIndex]),this.setStrokeWidth(1)}),l++}stageScenery.add(layer),l=0,maxReferrals=ReferralId.length;for(var u=0;maxReferrals>=l;){if(decena=parseInt(l/10),secColor=l-10*decena,mustDrawReferral=0,mustDrawReferral=ReferralEndP[l]>=e&&ReferralStaP[l]<=s?1:0,1==mustDrawReferral){if(u++,startDrawPat=ReferralStaP[l]-e,1==u){startDrawPat=0;var f=l}ReferralEndP[l]<=s?(endDrawPat=ReferralEndP[l]-e,brokenReferral[l]=0):(endDrawPat=s-e,brokenReferral[l]=1);var p=-(.5*Math.PI)+startDrawPat*unidad,v=-(.5*Math.PI)+endDrawPat*unidad;referralWidth=unidad*(endDrawPat-startDrawPat+1);var g=new Kinetic.Wedge({x:200,y:175,radius:100,angle:referralWidth,fill:DrColor[secColor],stroke:DrColor[secColor],strokeWidth:1,rotation:p,name:"cosa",opacity:.4});layerEvents.add(g),DrawArcRef(p+.1,p+referralWidth-.1,DrColor[secColor]),TextFontsize=12,c.font="bold 12px Helvetica",DrName=ReferralName[l].substr(0,12),DrNameFULL=ReferralNameFULL[l].substr(0,12),ReferralName[l].length>11&&(DrName+="..");var D=p+(v-p)/2,P=200+140*Math.cos(D),y=175+140*Math.sin(D),R=c.measureText(DrName),b=R.width;if(200>P&&(P-=b),175>y)var N="bottom",T=15;else var N="top",T=0;c.beginPath(),c.rect(P-5,y-T,b+10,16);var S=new Kinetic.Rect({x:P-5,y:y-T,width:b+10,height:16,fill:DrColor[secColor],stroke:"grey",strokeWidth:1,opacity:.8});layerDr.add(S),c.fillStyle=DrColor[secColor],c.fill(),c.lineWidth=1,c.strokeStyle=DrColor[secColor],c.stroke(),c.fillStyle="white",c.font="bold 12px Helvetica",c.textBaseline=N,c.fillText(DrName,P,y);var E=new Kinetic.Text({x:P,y:y-T+2,text:DrName,fontSize:12,fontFamily:"Helvetica",fill:"white"});layerDr.add(E),g.on("touchstart click mouseover",function(e){document.body.style.cursor="pointer";e.targetNode;this.setOpacity(.6),this.setStroke("black"),this.setStrokeWidth(2),layerEvents.draw(),m=this.index,RealM=m+f,$("#DrName").html(0==brokenReferral[m]?ReferralNameFULL[RealM]:ReferralNameFULL[RealM]+"../.");var t="";"th"==language?t="Miembros":"en"==language&&(t="Members"),$("#DrEmail").html(DoctorsEmails[m]),$("#DrPatients").html(ReferralNumPats[RealM]),$("#AdditHtml").html(" "+t),$("#DrTtoVText").html("Time to Visit: "+Math.round(ReferralTTV[RealM]/ReferralNumPats[RealM])+" days"),this.setOpacity(.4),this.setStroke(DrColor[m]),this.setStrokeWidth(1)}),g.on("mouseout",function(){document.body.style.cursor="default"}),g.on("click",function(){var e=this.index,r=parseInt(e)+parseInt(f),t=ReferralId[r],a=$("#MEDID").val(),o="",s="getSents.php?Doctor="+a+"&DrEmail="+o+"&NReports=3&ToDoc="+t;$("#TablaSents").load(s),$("#TablaSents").trigger("update");var i="<b> Dr. "+DoctorsNames[t]+"</b>";$("#radartext").html(i),$("#BotonBusquedaReset").show()})}l++}stageScenery.add(layer),stageScenery.add(layerDr),stageScenery.add(layerEvents),stageScenery.add(layerArcs)}function DrawArcRef(e,r,t){var a=new Kinetic.Shape({drawFunc:function(t){var a=t.getContext(),a=t.getContext("2d");a.globalAlpha=.7,a.beginPath(),a.arc(200,175,120,e,r,!1),t.stroke(this)},fill:t,stroke:t,opacity:.7,strokeWidth:10});layerArcs.add(a)}function drawReferredOutRadar(){$thisreco=0,PatientName=Array(),PatientStage=Array(),PatientDoctor=Array(),PatientDoctorFULL=Array(),DoctorId=Array(),DoctorEmail=Array(),PatientTTV=Array(),DoctorsNames=Array(),DoctorsNamesFULL=Array(),DoctorsEmails=Array();var e=0;for($("#Group_toggle").is(":checked")&&(e=1),getReferredPatients("getReferredPatients.php?group="+e);$thisreco<ReferredPatients.length;)PatientName[$thisreco]=ReferredPatients[$thisreco].PatientName,PatientStage[$thisreco]=ReferredPatients[$thisreco].PatientStage,PatientDoctor[$thisreco]=ReferredPatients[$thisreco].PatientDoctor,PatientDoctorFULL[$thisreco]=ReferredPatients[$thisreco].PatientDoctorFULL,DoctorId[$thisreco]=ReferredPatients[$thisreco].IdMED2,DoctorEmail[$thisreco]=ReferredPatients[$thisreco].EmailDoctor,PatientDoctor[$thisreco]<"   "&&(PatientDoctor[$thisreco]=DoctorEmail[$thisreco]),PatientTTV[$thisreco]=ReferredPatients[$thisreco].TTV,DoctorsNames[DoctorId[$thisreco]]=PatientDoctor[$thisreco],DoctorsNamesFULL[DoctorId[$thisreco]]=PatientDoctorFULL[$thisreco],DoctorsEmails[DoctorId[$thisreco]]=DoctorEmail[$thisreco],$thisreco++;for($thisreco=0,ReferralId=Array(),ReferralName=Array(),ReferralNameFULL=Array(),ReferralStaP=Array(),ReferralEndP=Array(),ReferralNumPats=Array(),ReferralTTV=Array(),brokenReferral=Array(),ReferralNumber=0,LatestPatient=0,LatestDoctor=0,SumTimes=0,MeanTTV=0;$thisreco<=ReferredPatients.length;)$thisreco>0&&PatientDoctor[$thisreco]!=LatestDoctor&&(ReferralStaP[ReferralNumber]=LatestPatient,ReferralEndP[ReferralNumber]=$thisreco-1,ReferralId[ReferralNumber]=DoctorId[$thisreco-1],ReferralName[ReferralNumber]=DoctorsNames[DoctorId[$thisreco-1]],ReferralNameFULL[ReferralNumber]=DoctorsNamesFULL[DoctorId[$thisreco-1]],ReferralNumPats[ReferralNumber]=ReferralEndP[ReferralNumber]-ReferralStaP[ReferralNumber]+1,ReferralTTV[ReferralNumber]=SumTimes,MeanTTV+=Math.round(ReferralTTV[ReferralNumber]/ReferralNumPats[ReferralNumber]),SumTimes=0,LatestPatient=$thisreco,LatestDoctor=PatientDoctor[$thisreco],ReferralNumber++),SumTimes+=parseInt(PatientTTV[$thisreco]),$thisreco++;NPatients=$thisreco-1,NReferrals=ReferralNumber,MaxPatDisplay=20,NPatients>MaxPatDisplay?(Pages=Math.ceil(NPatients/MaxPatDisplay),PatientsPage=Math.ceil(NPatients/Pages)):(Pages=1,PatientsPage=NPatients,$("#MorePage").css("visibility","hidden"),$("#LessPage").css("visibility","hidden"),$("#pageNumber").css("visibility","hidden")),ActualPage=1,RadarPage(),$("#BotonBusquedaSents").trigger("click")}function drawReferredInRadar(){PatientName=Array(),PatientStage=Array(),PatientDoctor=Array(),PatientDoctorFULL=Array(),DoctorId=Array(),DoctorEmail=Array(),PatientTTV=Array(),DoctorsNames=Array(),DoctorsNamesFULL=Array(),DoctorsEmails=Array();var e=0;for($("#Group_toggle").is(":checked")&&(e=1),getReferredPatients("getReferredInPatients.php?group="+e),$thisreco=0;$thisreco<ReferredPatients.length;)PatientName[$thisreco]=ReferredPatients[$thisreco].PatientName,PatientStage[$thisreco]=ReferredPatients[$thisreco].PatientStage,PatientDoctor[$thisreco]=ReferredPatients[$thisreco].PatientDoctor,PatientDoctorFULL[$thisreco]=ReferredPatients[$thisreco].PatientDoctorFULL,DoctorId[$thisreco]=ReferredPatients[$thisreco].IdMED2,DoctorEmail[$thisreco]=ReferredPatients[$thisreco].EmailDoctor,PatientDoctor[$thisreco]<"   "&&(PatientDoctor[$thisreco]=DoctorEmail[$thisreco]),PatientTTV[$thisreco]=ReferredPatients[$thisreco].TTV,DoctorsNames[DoctorId[$thisreco]]=PatientDoctor[$thisreco],DoctorsNamesFULL[DoctorId[$thisreco]]=PatientDoctorFULL[$thisreco],DoctorsEmails[DoctorId[$thisreco]]=DoctorEmail[$thisreco],$thisreco++;{var r=Array(),t=Array(),a=Array(),o=Array(),s=Array(),i=Array(),n=Array();Array()}$thisreco=0;for(var l=0,d=0,h=0,m=0,u=0;$thisreco<=ReferredPatients.length;)$thisreco>0&&PatientDoctor[$thisreco]!=h&&(o[l]=d,s[l]=$thisreco-1,r[l]=DoctorId[$thisreco-1],t[l]=DoctorsNames[DoctorId[$thisreco-1]],a[l]=DoctorsNamesFULL[DoctorId[$thisreco-1]],i[l]=s[l]-o[l]+1,n[l]=m,u+=Math.round(n[l]/i[l]),m=0,d=$thisreco,h=PatientDoctor[$thisreco],l++),m+=parseInt(PatientTTV[$thisreco]),$thisreco++;NPatients=$thisreco-1,NReferrals=l,MaxPatDisplay=20,NPatients>MaxPatDisplay?(Pages=Math.ceil(NPatients/MaxPatDisplay),PatientsPage=Math.ceil(NPatients/Pages)):(Pages=1,PatientsPage=NPatients,$("#MorePage").css("visibility","hidden"),$("#LessPage").css("visibility","hidden"),$("#pageNumber").css("visibility","hidden")),ActualPage=1,RadarPage(),$("#BotonBusquedaPermit").trigger("click")}function SendWelcomeMessage(){var e=$("#WelMes").val(),r="I referred a new member to you.";reportids=reportids.replace(/\s+$/g," ");var t=$("#MEDID").val(),a="GetConnectionId.php?Tipo=1&IdPac="+IdPaciente+"&IdDoc="+IdDoctor+"&IdDocOrigin="+t;o=LanzaAjax(a);var a="sendMessage.php?sender="+t+"&receiver="+IdDoctor+"&patient="+IdPaciente+"&content="+e+"&subject="+r+"&attachments="+reportids+"&connection_id="+o,o=LanzaAjax(a)}function attachReports(){reportids="",$('input[type=checkbox][id^="reportcol"]').each(function(){var e=this.checked?"1":"0";if(1==e){var r=$(this).parents("div.attachments").attr("id");reportcheck.push(this.id),reportids=reportids+r+" "}});var e=!1;if(reportids>""&&(e=!0),e);else{for(reportids="",i=0;i<reportcheck.length;i++)document.getElementById(reportcheck[i]).checked=!1;reportcheck.length=0}}function showAttachmentIcon(e){e>0?($("#attachment_icon").css("display","visible"),$("#attachment_icon").css("color","#22aeff"),$("#attachment_icon").addClass("icon-spin")):($("#attachment_icon").css("color","#ccc"),$("#attachment_icon").removeClass("icon-spin"))}function createPatientReports(){var r="0",t=IdPaciente,a=$("#MEDID").val(),o="createAttachmentStream.php?ElementDOM=na&EntryTypegroup="+r+"&Usuario="+t+"&MedID="+a;$("#attachments").load(o),$("#attachments").trigger("update"),$("#attachments").show()}function createPatientReportsNEW(){var r="0",t=IdPaciente,a=$("#MEDID").val();$("#ReportStream").html(""),$("#H2M_Spin_Stream").show(),setTimeout(function(){var e="createAttachmentStreamNEWTEST.php?ElementDOM=na&EntryTypegroup="+r+"&Usuario="+t+"&MedID="+a;console.log(e),$.get(e,function(e){$("#ReportStream").html(e),$("#Phase3Container").show(),$("#H2M_Spin_Stream").hide()})},1e3)}function displayalertnotification(e){var r={title:"status",text:e,image:"images/Icono_H2M.png",sticky:!1,time:"3000"};$.gritter.add(r)}function getBlocks(e){$.ajax({url:e,dataType:"json",async:!1,success:function(e){blocks=e.items}})}function getUserData(e){var r="getUserData.php?UserId="+e;$.ajax({url:r,dataType:"json",async:!1,success:function(e){user=e.items}})}function getMedCreator(e){var r="getMedCreator.php?UserId="+e;$.ajax({url:r,dataType:"json",async:!1,success:function(e){doctor=e.items}})}function EnMail(e,r,t){var a="EnMail.php?aQuien="+e+"&Tema="+r+"&Contenido="+t,o="Temporal";$.ajax({url:a,dataType:"html",async:!1,complete:function(){},success:function(e){"string"==typeof e&&(o=e)}})}function LanzaAjax(e){var r="SIN MODIFICACIÃ“N";return $.ajax({url:e,dataType:"html",async:!1,complete:function(){},success:function(e){"string"==typeof e&&(r=e)}}),r}var med_id=$("#MEDID").val(),paciente="",destino="",Nondestino="",IdPaciente=-1,IdDoctor=-1,timeoutTime=18e6,timeoutTimer=setTimeout(ShowTimeOutWarning,timeoutTime),active_session_timer=6e4,sessionTimer=setTimeout(inform_about_session,active_session_timer);$(window).load(function(){function e(e){$.ajax({url:e,dataType:"script",async:!1})}function r(r,t){e("realtime-notifications/lib/gritter/js/jquery.gritter.min.js");var a={title:r,text:t,image:"images/Icono_H2M.png",sticky:!1,time:"3000"};$.gritter.add(a)}var t=new Pusher("d869a07d8f17a76448ed"),a=$("#MEDID").val(),o=t.subscribe(a);o.bind("notification",function(e){r("New Message",e)}),$(".loader_spinner").fadeOut("slow")});var stageScenery=new Kinetic.Stage({container:"CanvasContainer",width:450,height:350}),layer=new Kinetic.Layer,layerDr=new Kinetic.Layer,layerEvents=new Kinetic.Layer,layerArcs=new Kinetic.Layer,unidad=.1*Math.PI,PatientName=Array(),PatientStage=Array(),PatientDoctor=Array(),PatientDoctorFULL=Array(),DoctorId=Array(),DoctorEmail=Array(),PatientTTV=Array(),DoctorsNames=Array(),DoctorsNamesFULL=Array(),DoctorsEmails=Array(),IsOn=Array(),IsOnCounter=0,IsOnCounter2=0,group=0;getInitialRadarData();var DrColor=Array(),ReferralId=Array(),ReferralName=Array(),ReferralNameFULL=Array(),ReferralStaP=Array(),ReferralEndP=Array(),ReferralNumPats=Array(),ReferralTTV=Array(),brokenReferral=Array();$thisreco=0;for(var ReferralNumber=0,LatestPatient=0,LatestDoctor=0,SumTimes=0,MeanTTV=0;$thisreco<=ReferredPatients.length;)$thisreco>0&&PatientDoctor[$thisreco]!=LatestDoctor&&(ReferralStaP[ReferralNumber]=LatestPatient,ReferralEndP[ReferralNumber]=$thisreco-1,ReferralId[ReferralNumber]=DoctorId[$thisreco-1],ReferralName[ReferralNumber]=DoctorsNames[DoctorId[$thisreco-1]],ReferralNameFULL[ReferralNumber]=DoctorsNamesFULL[DoctorId[$thisreco-1]],ReferralNumPats[ReferralNumber]=ReferralEndP[ReferralNumber]-ReferralStaP[ReferralNumber]+1,ReferralTTV[ReferralNumber]=SumTimes,MeanTTV+=Math.round(ReferralTTV[ReferralNumber]/ReferralNumPats[ReferralNumber]),SumTimes=0,LatestPatient=$thisreco,LatestDoctor=PatientDoctor[$thisreco],ReferralNumber++),SumTimes+=parseInt(PatientTTV[$thisreco]),$thisreco++;DrColor[0]="rgb(255,66,66)",DrColor[1]="rgb(105,120,250)",DrColor[2]="orange",DrColor[3]="rgb(255,66,166)",DrColor[4]="rgb(122,199,59)",DrColor[5]="rgb(115,100,59)",DrColor[6]="rgb(115,150,59)",DrColor[7]="rgb(115,250,59)",DrColor[8]="rgb(115,187,59)",DrColor[9]="rgb(115,187,159)";var NPatients,NReferrals,MaxPatDisplay;$(document).ready(loadRadarData),$("#MorePage").click(function(){Pages>ActualPage&&(ActualPage++,RadarPage())}),$("#LessPage").click(function(){ActualPage>1&&(ActualPage--,RadarPage())}),$(window).bind("load",function(){$("#BotonBusquedaSents").trigger("click"),$("#BotonBusquedaPermit").trigger("click")});var phase=1,ancho=$("#header-modal").width();$("#content_selpat").css("width",ancho),$("#content_seldr").css("width",ancho),$("#content_att").css("width",ancho),$("#content_addcom").css("width",ancho),$("#ScrollerContainer").css("width",5*ancho),$("body").bind("mousedown keydown",function(){clearTimeout(timeoutTimer),timeoutTimer=setTimeout(ShowTimeOutWarning,timeoutTime)});var user,doctor,reportcheck=new Array,reportids="",phaseReached=0,numReports=0;$("#PhaseNext").click(function(){4>phase?phase++:($("#CloseModal").trigger("click"),$("#SendButton").trigger("click"));var r=$("#header-modal").width()*(phase-1);switch($("#ContentScroller").animate({scrollLeft:r},175),phase>phaseReached&&(phaseReached=phase),phase>=phaseReached&&4>phase&&(3==phase?numReports=0:$("#PhaseNext").attr("disabled","true")),phase){case 1:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","#ccc"),$("#att").css("color","#ccc"),$("#addcom").css("color","#ccc");break;case 2:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","rgb(61, 147, 224)"),$("#att").css("color","#ccc"),$("#addcom").css("color","#ccc");break;case 3:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","rgb(61, 147, 224)"),$("#att").css("color","rgb(61, 147, 224)"),$("#addcom").css("color","#ccc"),createPatientReportsNEW();break;case 4:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","rgb(61, 147, 224)"),$("#att").css("color","rgb(61, 147, 224)"),$("#addcom").css("color","rgb(61, 147, 224)");break;default:alert("no phase detected")}4==phase&&(attachReports(),showAttachmentIcon(numReports))}),$("#PhasePrev").click(function(){3==phase&&$("#Attach").trigger("click"),phase>1&&phase--,phaseReached>phase&&$("#PhaseNext").removeAttr("disabled"),3==phase&&(numReports=0);var r=$("#header-modal").width()*(phase-1);switch(phase){case 1:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","#ccc"),$("#att").css("color","#ccc"),$("#addcom").css("color","#ccc");break;case 2:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","rgb(61, 147, 224)"),$("#att").css("color","#ccc"),$("#addcom").css("color","#ccc");break;case 3:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","rgb(61, 147, 224)"),$("#att").css("color","rgb(61, 147, 224)"),$("#addcom").css("color","#ccc"),createPatientReportsNEW();break;case 4:$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","rgb(61, 147, 224)"),$("#att").css("color","rgb(61, 147, 224)"),$("#addcom").css("color","rgb(61, 147, 224)");break;default:alert("no phase detected")}$("#ContentScroller").animate({scrollLeft:r},175)}),$("#BotonBusquedaPac").click(function(){var t=$("#SearchUser").val(),a=$("#SearchEmail").val(),o=$("#SearchIdUsFIXED").val(),s=$("#MEDID").val(),i="getFullUsersLINK.php?Usuario="+t+"&NReports=10&MEDID="+s+"&Email="+a+"&IdUsFIXED="+o;$("#TablaPac").load(i),$("#TablaPac").trigger("update")}),$("#BotonBusquedaMen").click(function(){var t=$("#SearchUser").val(),a=$("#MEDID").val(),o="getMessages.php?Usuario="+t+"&NReports=10&MEDID="+a;$("#TablaPac").load(o),$("#TablaPac").trigger("update")}),$("#BotonBusquedaPacCOMP").live("click",function(){var e=$("#SearchUserT").val(),r="",t=$("#MEDID").val(),a="getSearchUsers.php?Usuario="+e+"&UserDOB="+r+"&IdDoc="+t+"&NReports=3";$("#TablaPac").load(a),$("#TablaPac").trigger("update"),$("#BotonBusquedaSents").trigger("click")}),$("#BotonBusquedaMedCOMP").live("click",function(){var e=$("#SearchDoctor").val(),t=($("#DoctorEmail").val(),"getSearchDoctors.php?Doctor="+e+"&DrEmail=&NReports=3");$("#TablaMed").load(t),$("#TablaMed").trigger("update")}),$("#BotonWizard").click(function(){phase=1,phaseReached=1,numReports=0,$("#PhaseNext").attr("disabled","true");var r=0*$("#header-modal").width();$("#ContentScroller").animate({scrollLeft:r},175),paciente="",destino="",TextoS='<span style="color:grey;">Send </span><span style="color:#54bc00; font-size:30px;">   '+paciente+'   </span><span style="color:grey;"> to </span><span style="color:#22aeff; font-size:30px;">   '+destino+"   </span>",paciente>""&&destino>""&&(TextoS+=""),IsOnCounter=0,IsOnCounter2=0,$("#TextoSend").html(TextoS),$("#selpat").css("color","rgb(61, 147, 224)"),$("#seldr").css("color","#ccc"),$("#att").css("color","#ccc"),$("#addcom").css("color","#ccc"),$("#BotonModal").trigger("click"),$("#SearchUserT").value="",$("#SearchDoctor").value="",$("#DoctorEmail").value="",$("#TablaPac").empty(),$("#TablaMed").empty()});var IdMed=$("#MEDID").val(),url="getGroupDoctors.php?Doctor="+IdMed;RecTipo=LanzaAjax(url),$("#fill_doctors").html(RecTipo),0==$("#doclist").children().length&&$("#doclist").parent().parent().css("display","none"),$("#Cstate").click(function(){$("#BotonBusquedaSents").trigger("click")}),$("#Group_toggle").click(function(){var r=$("#myTab").find(".active");r.trigger("click"),"yellow"!=document.getElementsByClassName("grid").style.backgroundColor?document.getElementsByClassName("grid").style.backgroundColor="yellow":"yellow"==document.getElementsByClassName("grid").style.backgroundColor&&(document.getElementsByClassName("grid").style.backgroundColor="white")}),$("#BotonBusquedaSents").click(function(){var r=$("#MEDID").val(),t="",a="",o=0,s=0;a=""==$("#SearchUserUSERFIXED").val()?99:$("#SearchUserUSERFIXED").val(),$("#Cstate").is(":checked")&&(o=1),$("#Group_toggle").is(":checked")&&(s=1),$("#Wait11").show();var i="getSents.php?Doctor="+r+"&DrEmail="+t+"&NReports=3&Username="+a+"&state="+o+"&group="+s;$("#TablaSents").load(i),$("#TablaSents").trigger("update"),$("#BotonBusquedaReset").hide(),$("#Wait11").hide(),$("#radartext").html(""),DrawStats()}),$("#BotonBusquedaReset").click(function(){var r=$("#MEDID").val(),t="",a="";a=99;var o="getSents.php?Doctor="+r+"&DrEmail="+t+"&NReports=3&Username="+a;$("#Wait11").show(),$("#TablaSents").load(o),$("#TablaSents").trigger("update"),$("#radartext").html(""),$("#BotonBusquedaReset").hide(),$("#Wait11").hide(),DrawStats()}),$(".ROWREF").live("click",function(){var e=$(this).attr("id");window.location.replace("patientdetailMED-new.php?IdUsu="+e)}),$("#BotRevoke,#BotCancel").live("click",function(e){var r=$("#MEDID").val(),t=confirm("Are you sure that you want to revoke this referral connection?");if(t){var a=$(this).parents(".CFILASents").attr("id"),o="revokeReferralConnection.php?id="+a+"&docid="+r;RecTipo=LanzaAjax(o)}e.stopPropagation(),location.reload()}),$("#BotArchive").live("click",function(e){var r=confirm("Are you sure that you want to Archive this referral connection?");if(r){var t=$(this).parents(".CFILASents").attr("id"),a="ArchiveReferralConnection.php?id="+t;RecTipo=LanzaAjax(a),displayalertnotification("Referral connection Archived!"),$("#BotonBusquedaSents").trigger("click")}e.stopPropagation()}),$("#BotReminder").live("click",function(e){var r=confirm("Are you sure you want to send a reminder to the Doctor again?");if(r){var t=$(this).parents(".CFILASents").attr("id"),a="SendReminder.php?id="+t;RecTipo=LanzaAjax(a),displayalertnotification("Reminder has been sent."),$("#BotonBusquedaSents").trigger("click")}e.stopPropagation()}),$("#BotonBusquedaPermit").click(function(){var r=$("#MEDID").val(),t="",a="";a=""==$("#SearchUserUSERFIXED").val()?99:$("#SearchUserUSERFIXED").val();var o=0;$("#Group_toggle").is(":checked")&&(o=1);var s="getPermits.php?Doctor="+r+"&DrEmail="+t+"&NReports=3&Username="+a+"&group="+o;$("#TablaPermit").load(s),$("#TablaPermit").trigger("update"),DrawStats()}),$(".CFILASents").live("click",function(){var r=($(this).attr("id"),$("#MEDID").val()),t="",a="getPermits.php?Doctor="+r+"&DrEmail="+t+"&NReports=3";$("#TablaPermit").load(a),$("#TablaPermit").trigger("update")}),$("#sendmessages_inbox").live("click",function(){$("#doctorsdetails").find(":selected").attr("id"),$("#messagecontent_inbox").val().replace(/ /g,"sp0e").replace(/\r\n|\r|\n/g,"br8k"),$("#subjectname_inbox").val();reportids=reportids.replace(/\s+$/g," ");var a=LanzaAjax(cadena);$("#messagecontent_inbox").attr("value",""),$("#subjectname_inbox").attr("value",""),displaynotification("status",a);var a=LanzaAjax(cadena);reportids="",$("#attachment_icon").remove(),$("#message_modal").trigger("click")});var nonusertoken="-1";$("#SendButton").live("click",function(){var e="",r=0,t=0,a="";$("#c2").is(":checked")&&(e=" (will send text message also)",r=1);var o=$("#MEDID").val(),s=$("#IdMEDName").val(),i=$("#IdMEDSurname").val(),n=$("#cellphone").val();reportids=reportids.replace(/\s+$/g," ");var c;$("#c2_doc").is(":checked")&&(a=$("#doclist").val(),t=1);var h,l=$("#referral_type").val(),d=-1;if(h=null==doctor[0].Name?$("#DoctorEmail").val():doctor[0].IdMEDEmail,destino>""||Nondestino>""){if(destino>"")var m=confirm("Confirm sending member "+paciente+" to "+destino+" ?   "+e);else var m=confirm("Confirm sending member "+paciente+" to "+h+" ?   "+e);if(1==m){if(destino>""){var u="SendReferral.php?Tipo=1&IdPac="+IdPaciente+"&IdDoc="+IdDoctor+"&IdDocOrigin="+o+"&NameDocOrigin="+s+"&SurnameDocOrigin="+i+"&ToEmail="+h+"&From=&Leido=0&Push=0&estado=1&CallPhone="+r+"&CellPhone="+n+"&attachments="+reportids+"&Onbehalfdoc="+a+"&sendOnbehalf="+t+"&reftype="+l;c=LanzaAjax(u),console.log("From Send Referral"+c),$("#BotonBusquedaSents").trigger("click"),SendWelcomeMessage()}else if(Nondestino>""){var u="SendReferral.php?Tipo=0&token="+nonusertoken+"&IdPac="+IdPaciente+"&IdDoc="+IdDoctor+"&IdDocOrigin="+o+"&NameDocOrigin="+s+"&SurnameDocOrigin="+i+"&ToEmail="+Nondestino+"&From=&Leido=0&Push=0&estado=1&CallPhone="+r+"&CellPhone="+n+"&attachments="+reportids+"&Onbehalfdoc="+a+"&sendOnbehalf="+t+"&reftype="+l;c=LanzaAjax(u),$("#BotonBusquedaSents").trigger("click"),SendWelcomeMessage(),d=0}}else alert("Member Referral Cancelled."),d=1}var f=parseInt(c);f?3==f&&alert("Referral request already present for this member!"):0==d&&alert("Although this email is already present in the system, your referral request has been sent. Please make sure you use the filter button for normal referral process!"),$("#TextoSend").html(""),destino="",Nondestino="",location.reload()}),$(".CFILADoctor").live("click",function(){var e=$(this).attr("id");getMedCreator(e),destino="Dr. "+doctor[0].Name+" "+doctor[0].Surname,IdDoctor=doctor[0].id,PhoneDoctor=doctor[0].phone,PhoneDoctor>""&&$("#cellphone").val(PhoneDoctor),Nondestino="",TextoS='<span style="color:grey;">Send </span><span style="color:#54bc00; font-size:30px;">   '+paciente+'   </span><span style="color:grey;"> to </span><span style="color:#22aeff; font-size:30px;">   '+destino+"   </span>",paciente>""&&destino>""&&(TextoS+=""),$("#PhaseNext").removeAttr("disabled"),$("#TextoSend").html(TextoS),$("#PhaseNext").trigger("click")}),$(".CFILAMODAL").live("click",function(){var e=$(this).attr("id");getUserData(e),paciente=user[0].Name+" "+user[0].Surname,IdPaciente=user[0].Identif,TextoS=Nondestino>""?'<span style="color:grey;">Send </span><span style="color:#54bc00; font-size:30px;">   '+paciente+'   </span><span style="color:grey;"> to </span><span style="color:#22aeff; font-size:30px;">   '+Nondestino+"   </span>":'<span style="color:grey;">Send </span><span style="color:#54bc00; font-size:30px;">   '+paciente+'   </span><span style="color:grey;"> to </span><span style="color:#22aeff; font-size:30px;">   '+destino+"   </span>",paciente>""&&destino>""?TextoS+='<p><span><input type="button" class="btn btn-info" value="Attach Reports" id="AttachButton" style="margin-top:10px;"></p>':paciente>""&&Nondestino>""&&(TextoS+=""),$("#PhaseNext").removeAttr("disabled"),$("#TextoSend").html(TextoS),$("#PhaseNext").trigger("click")}),$("#AddNonUser").live("click",function(){if($("#DoctorEmail").val().length>0){destino="";var e=$("#DoctorEmail").val();console.log("adding doctor"),$.get("getMedCreator.php?UserId=-1&email="+e,function(r){doctor=new Array,doctor=r.items,console.log(doctor[0]),IdDoctor=doctor[0].id,console.log(IdDoctor),Nondestino=e,nonusertoken=doctor[0].token,TextoS='<span style="color:grey;">Send </span><span style="color:#54bc00; font-size:30px;">   '+paciente+'   </span><span style="color:grey;"> to </span><span style="color:#22aeff; font-size:30px;">   '+Nondestino+"   </span>",paciente>""&&destino>""?TextoS+="":paciente>""&&Nondestino>""&&(TextoS+=""),$("#PhaseNext").removeAttr("disabled"),$("#TextoSend").html(TextoS),$("#PhaseNext").trigger("click")},"json")}}),$("#AttachButton").live("click",function(){createPatientReports(),setTimeout(function(){$("#report_modal").trigger("click")},500)}),$(".CheckContainer").live("mousedown",function(){for(var e=$(this).attr("id"),r=0,t=0;IsOnCounter>r;)IsOn[r]==e&&(IsOn[r]=0,IsOnCounter2--,t=1),r++;0==t&&(IsOnCounter++,IsOnCounter2++,IsOn[IsOnCounter]=e),$("#NumberRA").html(IsOnCounter2+" Reports Attached"),IsOnCounter2>0?($("#attachment_icon").css("display","visible"),$("#attachment_icon").css("color","#22aeff"),$("#attachment_icon").addClass("icon-spin")):($("#attachment_icon").css("color","#ccc"),$("#attachment_icon").removeClass("icon-spin"))}),$('input[type=checkbox][id^="reportcol"]').live("click",function(){var e=this.checked?"1":"0";1==e?numReports++:numReports--}),$(".CFILA").live("click",function(){}),$(".view-button").live("click",function(){var e=$(this).attr("id");$("#queId").attr("value",e);$("#IdMEDName").val(),$("#IdMEDSurname").val(),$("#PasswordEnt").val(),$("#MEDID").val(),$("#IdMEDEmail").val();$("#BotonModal").trigger("click")}),$("#ConfirmaLink").live("click",function(){var e=$("#queId").val();if(getUserData(e),""==user[0].email){var r=user[0].IdCreator;alert("orphan user . Creator= "+r),getMedCreator(r);var t=$("#IdMEDName").val(),a=$("#IdMEDSurname").val(),o=$("#MEDID").val(),s=$("#IdMEDEmail").val(),i="Request conection from Dr. "+t+" "+a,n="Dr. "+t+" "+a+" is requesting to establish connection with your member named: "+user[0].Name+" "+user[0].Surname+" (UserId:  "+e+"). Please confirm, or just close this message to reject.",l=("Dr. "+doctor[0].Name+" "+doctor[0].Surname,"MsgInterno.php?Tipo=1&IdPac="+user[0].Identif+"&To="+doctor[0].id+"&ToEmail="+doctor[0].IdMEDEmail+"&From="+o+"&FromEmail="+s+"&Subject="+i+"&Content="+n+"&Leido=0&Push=0&estado=1"),d=LanzaAjax(l)}else{var t=$("#IdMEDName").val(),a=$("#IdMEDSurname").val(),o=$("#MEDID").val(),s=$("#IdMEDEmail").val(),i="Request conection ",n="Dr. "+t+" "+a+" is requesting to establish connection with you (UserId:  "+e+"). Please confirm, or just close this message to reject.",l="MsgInterno.php?Tipo=0&IdPac=0&To="+e+"&ToEmail="+user[0].email+"&From="+o+"&FromEmail="+s+"&Subject="+i+"&Content="+n+"&Leido=0&Push=0&estado=1",d="Temporal";$.ajax({url:l,dataType:"html",async:!1,complete:function(){},success:function(e){"string"==typeof e&&(d=e)}})}$("#CloseModal").trigger("click"),$("#BotonBusquedaPac").trigger("click")}),$("#Wait1").hide().ajaxStart(function(){$(this).show()}).ajaxStop(function(){$(this).hide()}),window.onload=function(){var e=parseInt($("#PaquetesSI").val()),r=parseInt($("#PaquetesNO").val()),t=e+r,a=Math.floor(100*e/t),o=Math.floor(100*r/t);Morris.Donut({element:"MiDonut",colors:["#0fa200","#ff5d5d"],formatter:function(e){return e+" %"},data:[{label:"IN USE",value:a},{label:"Not used",value:o}]})};